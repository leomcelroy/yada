(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var ut;const ot=window,q=ot.trustedTypes,At=q?q.createPolicy("lit-html",{createHTML:o=>o}):void 0,it="$lit$",U=`lit$${(Math.random()+"").slice(9)}$`,$t="?"+U,he=`<${$t}>`,O=document,V=()=>O.createComment(""),tt=o=>o===null||typeof o!="object"&&typeof o!="function",Dt=Array.isArray,Ht=o=>Dt(o)||typeof(o==null?void 0:o[Symbol.iterator])=="function",dt=`[ 	
\f\r]`,K=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,bt=/-->/g,_t=/>/g,P=RegExp(`>|${dt}(?:([^\\s"'>=/]+)(${dt}*=${dt}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),xt=/'/g,Nt=/"/g,Ot=/^(?:script|style|textarea|title)$/i,jt=o=>(n,...t)=>({_$litType$:o,strings:n,values:t}),T=jt(1),pt=jt(2),F=Symbol.for("lit-noChange"),N=Symbol.for("lit-nothing"),kt=new WeakMap,H=O.createTreeWalker(O,129,null,!1);function qt(o,n){if(!Array.isArray(o)||!o.hasOwnProperty("raw"))throw Error("invalid template strings array");return At!==void 0?At.createHTML(n):n}const Ft=(o,n)=>{const t=o.length-1,e=[];let s,i=n===2?"<svg>":"",l=K;for(let d=0;d<t;d++){const c=o[d];let u,h,f=-1,p=0;for(;p<c.length&&(l.lastIndex=p,h=l.exec(c),h!==null);)p=l.lastIndex,l===K?h[1]==="!--"?l=bt:h[1]!==void 0?l=_t:h[2]!==void 0?(Ot.test(h[2])&&(s=RegExp("</"+h[2],"g")),l=P):h[3]!==void 0&&(l=P):l===P?h[0]===">"?(l=s!=null?s:K,f=-1):h[1]===void 0?f=-2:(f=l.lastIndex-h[2].length,u=h[1],l=h[3]===void 0?P:h[3]==='"'?Nt:xt):l===Nt||l===xt?l=P:l===bt||l===_t?l=K:(l=P,s=void 0);const m=l===P&&o[d+1].startsWith("/>")?" ":"";i+=l===K?c+he:f>=0?(e.push(u),c.slice(0,f)+it+c.slice(f)+U+m):c+U+(f===-2?(e.push(void 0),d):m)}return[qt(o,i+(o[t]||"<?>")+(n===2?"</svg>":"")),e]};class et{constructor({strings:n,_$litType$:t},e){let s;this.parts=[];let i=0,l=0;const d=n.length-1,c=this.parts,[u,h]=Ft(n,t);if(this.el=et.createElement(u,e),H.currentNode=this.el.content,t===2){const f=this.el.content,p=f.firstChild;p.remove(),f.append(...p.childNodes)}for(;(s=H.nextNode())!==null&&c.length<d;){if(s.nodeType===1){if(s.hasAttributes()){const f=[];for(const p of s.getAttributeNames())if(p.endsWith(it)||p.startsWith(U)){const m=h[l++];if(f.push(p),m!==void 0){const g=s.getAttribute(m.toLowerCase()+it).split(U),r=/([.?@])?(.*)/.exec(m);c.push({type:1,index:i,name:r[2],strings:g,ctor:r[1]==="."?Wt:r[1]==="?"?zt:r[1]==="@"?Yt:nt})}else c.push({type:6,index:i})}for(const p of f)s.removeAttribute(p)}if(Ot.test(s.tagName)){const f=s.textContent.split(U),p=f.length-1;if(p>0){s.textContent=q?q.emptyScript:"";for(let m=0;m<p;m++)s.append(f[m],V()),H.nextNode(),c.push({type:2,index:++i});s.append(f[p],V())}}}else if(s.nodeType===8)if(s.data===$t)c.push({type:2,index:i});else{let f=-1;for(;(f=s.data.indexOf(U,f+1))!==-1;)c.push({type:7,index:i}),f+=U.length-1}i++}}static createElement(n,t){const e=O.createElement("template");return e.innerHTML=n,e}}function j(o,n,t=o,e){var s,i,l,d;if(n===F)return n;let c=e!==void 0?(s=t._$Co)===null||s===void 0?void 0:s[e]:t._$Cl;const u=tt(n)?void 0:n._$litDirective$;return(c==null?void 0:c.constructor)!==u&&((i=c==null?void 0:c._$AO)===null||i===void 0||i.call(c,!1),u===void 0?c=void 0:(c=new u(o),c._$AT(o,t,e)),e!==void 0?((l=(d=t)._$Co)!==null&&l!==void 0?l:d._$Co=[])[e]=c:t._$Cl=c),c!==void 0&&(n=j(o,c._$AS(o,n.values),c,e)),n}class Gt{constructor(n,t){this._$AV=[],this._$AN=void 0,this._$AD=n,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(n){var t;const{el:{content:e},parts:s}=this._$AD,i=((t=n==null?void 0:n.creationScope)!==null&&t!==void 0?t:O).importNode(e,!0);H.currentNode=i;let l=H.nextNode(),d=0,c=0,u=s[0];for(;u!==void 0;){if(d===u.index){let h;u.type===2?h=new W(l,l.nextSibling,this,n):u.type===1?h=new u.ctor(l,u.name,u.strings,this,n):u.type===6&&(h=new Kt(l,this,n)),this._$AV.push(h),u=s[++c]}d!==(u==null?void 0:u.index)&&(l=H.nextNode(),d++)}return H.currentNode=O,i}v(n){let t=0;for(const e of this._$AV)e!==void 0&&(e.strings!==void 0?(e._$AI(n,e,t),t+=e.strings.length-2):e._$AI(n[t])),t++}}class W{constructor(n,t,e,s){var i;this.type=2,this._$AH=N,this._$AN=void 0,this._$AA=n,this._$AB=t,this._$AM=e,this.options=s,this._$Cp=(i=s==null?void 0:s.isConnected)===null||i===void 0||i}get _$AU(){var n,t;return(t=(n=this._$AM)===null||n===void 0?void 0:n._$AU)!==null&&t!==void 0?t:this._$Cp}get parentNode(){let n=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(n==null?void 0:n.nodeType)===11&&(n=t.parentNode),n}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(n,t=this){n=j(this,n,t),tt(n)?n===N||n==null||n===""?(this._$AH!==N&&this._$AR(),this._$AH=N):n!==this._$AH&&n!==F&&this._(n):n._$litType$!==void 0?this.g(n):n.nodeType!==void 0?this.$(n):Ht(n)?this.T(n):this._(n)}k(n){return this._$AA.parentNode.insertBefore(n,this._$AB)}$(n){this._$AH!==n&&(this._$AR(),this._$AH=this.k(n))}_(n){this._$AH!==N&&tt(this._$AH)?this._$AA.nextSibling.data=n:this.$(O.createTextNode(n)),this._$AH=n}g(n){var t;const{values:e,_$litType$:s}=n,i=typeof s=="number"?this._$AC(n):(s.el===void 0&&(s.el=et.createElement(qt(s.h,s.h[0]),this.options)),s);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===i)this._$AH.v(e);else{const l=new Gt(i,this),d=l.u(this.options);l.v(e),this.$(d),this._$AH=l}}_$AC(n){let t=kt.get(n.strings);return t===void 0&&kt.set(n.strings,t=new et(n)),t}T(n){Dt(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let e,s=0;for(const i of n)s===t.length?t.push(e=new W(this.k(V()),this.k(V()),this,this.options)):e=t[s],e._$AI(i),s++;s<t.length&&(this._$AR(e&&e._$AB.nextSibling,s),t.length=s)}_$AR(n=this._$AA.nextSibling,t){var e;for((e=this._$AP)===null||e===void 0||e.call(this,!1,!0,t);n&&n!==this._$AB;){const s=n.nextSibling;n.remove(),n=s}}setConnected(n){var t;this._$AM===void 0&&(this._$Cp=n,(t=this._$AP)===null||t===void 0||t.call(this,n))}}class nt{constructor(n,t,e,s,i){this.type=1,this._$AH=N,this._$AN=void 0,this.element=n,this.name=t,this._$AM=s,this.options=i,e.length>2||e[0]!==""||e[1]!==""?(this._$AH=Array(e.length-1).fill(new String),this.strings=e):this._$AH=N}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(n,t=this,e,s){const i=this.strings;let l=!1;if(i===void 0)n=j(this,n,t,0),l=!tt(n)||n!==this._$AH&&n!==F,l&&(this._$AH=n);else{const d=n;let c,u;for(n=i[0],c=0;c<i.length-1;c++)u=j(this,d[e+c],t,c),u===F&&(u=this._$AH[c]),l||(l=!tt(u)||u!==this._$AH[c]),u===N?n=N:n!==N&&(n+=(u!=null?u:"")+i[c+1]),this._$AH[c]=u}l&&!s&&this.j(n)}j(n){n===N?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,n!=null?n:"")}}class Wt extends nt{constructor(){super(...arguments),this.type=3}j(n){this.element[this.name]=n===N?void 0:n}}const pe=q?q.emptyScript:"";class zt extends nt{constructor(){super(...arguments),this.type=4}j(n){n&&n!==N?this.element.setAttribute(this.name,pe):this.element.removeAttribute(this.name)}}class Yt extends nt{constructor(n,t,e,s,i){super(n,t,e,s,i),this.type=5}_$AI(n,t=this){var e;if((n=(e=j(this,n,t,0))!==null&&e!==void 0?e:N)===F)return;const s=this._$AH,i=n===N&&s!==N||n.capture!==s.capture||n.once!==s.once||n.passive!==s.passive,l=n!==N&&(s===N||i);i&&this.element.removeEventListener(this.name,this,s),l&&this.element.addEventListener(this.name,this,n),this._$AH=n}handleEvent(n){var t,e;typeof this._$AH=="function"?this._$AH.call((e=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&e!==void 0?e:this.element,n):this._$AH.handleEvent(n)}}class Kt{constructor(n,t,e){this.element=n,this.type=6,this._$AN=void 0,this._$AM=t,this.options=e}get _$AU(){return this._$AM._$AU}_$AI(n){j(this,n)}}const me={O:it,P:U,A:$t,C:1,M:Ft,L:Gt,R:Ht,D:j,I:W,V:nt,H:zt,N:Yt,U:Wt,F:Kt},Tt=ot.litHtmlPolyfillSupport;Tt==null||Tt(et,W),((ut=ot.litHtmlVersions)!==null&&ut!==void 0?ut:ot.litHtmlVersions=[]).push("2.8.0");const ge=(o,n,t)=>{var e,s;const i=(e=t==null?void 0:t.renderBefore)!==null&&e!==void 0?e:n;let l=i._$litPart$;if(l===void 0){const d=(s=t==null?void 0:t.renderBefore)!==null&&s!==void 0?s:null;i._$litPart$=l=new W(n.insertBefore(V(),d),d,void 0,t!=null?t:{})}return l._$AI(o),l},ve={name:"adder",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],state:{test:10},outputs:[{name:"sum",type:"number"}],onUpdate(o){return`
      <div>hello world</div>
      <div>the answer is ${o.outputs[0]}</div>
    `},func:(o,n)=>[o+n]},ye={name:"async_adder",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],outputs:[{name:"sum",type:"number"}],onUpdate(o){return`
      <div>hello world</div>
      <div>the answer is ${o.outputs[0]}</div>
    `},func:async(o,n)=>{const t=new Promise(e=>{setTimeout(()=>{e(o+n)},1e3)});return await Promise.all([t])}};function $e(){self.onmessage=function(o){const n=o.data,t=n.buf,e=n.w,s=n.h;var i=new Float32Array(e*s);function l(y,v,$,w){return($-w)*($-w)+y[w][v]*y[w][v]}function d(y,v,$,w){return(y[$][v]*y[$][v]-y[w][v]*y[w][v]+$*$-w*w)/(2*($-w))}for(var c=[],u=0;u<s;++u)c[u]=new Uint32Array(e);for(var u=0;u<s;++u)new Uint32Array(e);for(var u=0;u<s;++u)new Uint32Array(e);for(var h=new Uint32Array(s),f=new Uint32Array(s),p,u=0;u<s;++u){for(var m=-e,g=0;g<e;++g)t[(s-1-u)*e*4+g*4+0]!=0?(c[u][g]=0,m=g):c[u][g]=g-m;m=2*e;for(var g=e-1;g>=0;--g)t[(s-1-u)*e*4+g*4+0]!=0?m=g:(p=m-g,p<c[u][g]&&(c[u][g]=p))}for(var g=0;g<e;++g){var r=0;h[0]=0,f[0]=0;for(var u=1;u<s;++u){for(;r>=0&&l(c,g,h[r],f[r])>l(c,g,h[r],u);)r-=1;if(r<0)r=0,f[0]=u;else{var a=1+d(c,g,f[r],u);a<s&&(r+=1,f[r]=u,h[r]=a)}}for(var u=s-1;u>=0;--u)p=Math.sqrt(l(c,g,u,f[r])),i[(s-1-u)*e+g]=p,u==h[r]&&(r-=1)}self.postMessage([i,n.w,n.h]),self.close()}}const we={name:"img distance",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"distances",type:"img_float32"}],func:async o=>{const n=new Blob(["("+$e.toString()+"())"]),t=window.URL.createObjectURL(n),e=new Worker(t),s=new Promise(c=>{e.onmessage=u=>{const h=u.data,f={data:h[0],width:h[1],height:h[2]};c(f)}}),i=o.data,l=o.width,d=o.height;return e.postMessage({buf:i,w:l,h:d}),await Promise.all([s])}};function Ae(){function o(n){var t=n.height,e=n.width,s=n.data,i=new Uint8ClampedArray(t*e*4),l,d,c,u,h,f,p,m,g,r,a;for(r=1;r<t-1;++r)for(a=1;a<e-1;++a)l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],c=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],h=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],g=s[(t-2-r)*e*4+(a+1)*4+0]+s[(t-2-r)*e*4+(a+1)*4+1]+s[(t-2-r)*e*4+(a+1)*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],u=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],f=s[(t-r)*e*4+(a-1)*4+0]+s[(t-r)*e*4+(a-1)*4+1]+s[(t-r)*e*4+(a-1)*4+2],p=s[(t-r)*e*4+(a+1)*4+0]+s[(t-r)*e*4+(a+1)*4+1]+s[(t-r)*e*4+(a+1)*4+2],m=s[(t-2-r)*e*4+(a-1)*4+0]+s[(t-2-r)*e*4+(a-1)*4+1]+s[(t-2-r)*e*4+(a-1)*4+2],l!=c||l!=h||l!=g||l!=d||l!=u||l!=f||l!=p||l!=m?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);for(r=1;r<t-1;++r)a=e-1,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],f=s[(t-r)*e*4+(a-1)*4+0]+s[(t-r)*e*4+(a-1)*4+1]+s[(t-r)*e*4+(a-1)*4+2],m=s[(t-2-r)*e*4+(a-1)*4+0]+s[(t-2-r)*e*4+(a-1)*4+1]+s[(t-2-r)*e*4+(a-1)*4+2],u=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],h=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],l!=d||l!=h||l!=m||l!=u||l!=f?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),a=0,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],c=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],p=s[(t-r)*e*4+(a+1)*4+0]+s[(t-r)*e*4+(a+1)*4+1]+s[(t-r)*e*4+(a+1)*4+2],g=s[(t-2-r)*e*4+(a+1)*4+0]+s[(t-2-r)*e*4+(a+1)*4+1]+s[(t-2-r)*e*4+(a+1)*4+2],u=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],h=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],l!=c||l!=h||l!=g||l!=u||l!=p?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);for(a=1;a<e-1;++a)r=t-1,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],c=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],f=s[(t-r)*e*4+(a-1)*4+0]+s[(t-r)*e*4+(a-1)*4+1]+s[(t-r)*e*4+(a-1)*4+2],u=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],p=s[(t-r)*e*4+(a+1)*4+0]+s[(t-r)*e*4+(a+1)*4+1]+s[(t-r)*e*4+(a+1)*4+2],l!=d||l!=c||l!=f||l!=u||l!=p?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=0,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],c=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],m=s[(t-2-r)*e*4+(a-1)*4+0]+s[(t-2-r)*e*4+(a-1)*4+1]+s[(t-2-r)*e*4+(a-1)*4+2],h=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],g=s[(t-2-r)*e*4+(a+1)*4+0]+s[(t-2-r)*e*4+(a+1)*4+1]+s[(t-2-r)*e*4+(a+1)*4+2],l!=d||l!=c||l!=m||l!=h||l!=g?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);return r=0,a=0,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],c=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],h=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],g=s[(t-2-r)*e*4+(a+1)*4+0]+s[(t-2-r)*e*4+(a+1)*4+1]+s[(t-2-r)*e*4+(a+1)*4+2],l!=c||l!=h||l!=g?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=0,a=e-1,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],h=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],m=s[(t-2-r)*e*4+(a-1)*4+0]+s[(t-2-r)*e*4+(a-1)*4+1]+s[(t-2-r)*e*4+(a-1)*4+2],l!=d||l!=h||l!=m?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=t-1,a=0,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],c=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],u=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],p=s[(t-r)*e*4+(a+1)*4+0]+s[(t-r)*e*4+(a+1)*4+1]+s[(t-r)*e*4+(a+1)*4+2],l!=c||l!=u||l!=p?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=t-1,a=e-1,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],u=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],f=s[(t-r)*e*4+(a-1)*4+0]+s[(t-r)*e*4+(a-1)*4+1]+s[(t-r)*e*4+(a-1)*4+2],l!=d||l!=u||l!=f?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),new ImageData(i,e,t)}self.onmessage=function(n){const t=n.data;buf=o(t.img),self.postMessage([buf]),self.close()}}const be={name:"img edge detect",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async o=>{const n=new Blob(["("+Ae.toString()+"())"]),t=window.URL.createObjectURL(n),e=new Worker(t),s=new Promise(i=>{e.onmessage=l=>{i(l.data[0])}});return e.postMessage({img:o}),await Promise.all([s])}};function _e(){function o(n,t){for(var e=n.data,s=n.width,i=n.height,l=new Uint8ClampedArray(4*i*s),d=0;d<i;++d)for(var c=0;c<s;++c)e[(i-1-d)*s+c]<=t?(l[(i-1-d)*s*4+c*4+0]=255,l[(i-1-d)*s*4+c*4+1]=255,l[(i-1-d)*s*4+c*4+2]=255,l[(i-1-d)*s*4+c*4+3]=255):(l[(i-1-d)*s*4+c*4+0]=0,l[(i-1-d)*s*4+c*4+1]=0,l[(i-1-d)*s*4+c*4+2]=0,l[(i-1-d)*s*4+c*4+3]=255);return new ImageData(l,s,i)}self.onmessage=function(n){const t=n.data;buf=o(t.img,t.offset),self.postMessage([buf]),self.close()}}const xe={name:"img offset",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"offset",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(o,n)=>{const t=new Blob(["("+_e.toString()+"())"]),e=window.URL.createObjectURL(t),s=new Worker(e),i=new Promise(l=>{s.onmessage=d=>{l(d.data[0])}});return s.postMessage({img:o,offset:n}),await Promise.all([i])}},Ne={name:"read png",inputs:[{name:"imageRGBA",type:"img_uint8",input:"upload"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],func:o=>[o]};var Et=100;function ke(o,n){const t=document.createElement("canvas");t.width=n,t.height=o;const e=t.getContext("2d");e.beginPath(),e.rect(0,0,n,o),e.fillStyle="black",e.fill();var s=40,i=e.createLinearGradient(0,0,s,0);i.addColorStop(0,"black"),i.addColorStop(.5,"red"),i.addColorStop(1,"green"),e.fillStyle=i,e.fillRect(0,0,s,s);const l=10;return e.beginPath(),e.strokeStyle="#AAAAAA",e.arc(o/2,n/2,n/2-l,0,2*Math.PI),e.stroke(),e.getImageData(0,0,n,o)}const Te={name:"img sample",inputs:[{name:"height",type:"number",input:"box"},{name:"width",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(o,n)=>{o==0&&(o=Et),n==0&&(n=Et);var t=ke(o,n);return[t]}};function Ee(){self.onmessage=function(o){const n=o.data,t=n.buf,e=n.w,s=n.h,i=n.threshold;let l,d,c,u,h;for(var f=0;f<s;++f)for(var p=0;p<e;++p){l=t[(s-1-f)*e*4+p*4+0],d=t[(s-1-f)*e*4+p*4+1],c=t[(s-1-f)*e*4+p*4+2],u=t[(s-1-f)*e*4+p*4+3],h=(l+d+c)/(3*255);let m;u===0||h>=i?m=255:m=0,t[(s-1-f)*e*4+p*4+0]=m,t[(s-1-f)*e*4+p*4+1]=m,t[(s-1-f)*e*4+p*4+2]=m,t[(s-1-f)*e*4+p*4+3]=255}self.postMessage([t,e,s]),self.close()}}const Ce={name:"thresholdRGBA",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"threshold",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(o,n)=>{const t=new Blob(["("+Ee.toString()+"())"]),e=window.URL.createObjectURL(t),s=new Worker(e),i=new Promise(u=>{s.onmessage=h=>{const f=h.data,p={data:f[0],width:f[1],height:f[2]};u(p)}}),l=o.data,d=o.width,c=o.height;return s.postMessage({buf:l,w:d,h:c,threshold:n}),await Promise.all([i])}};function Se(){function o(n,t=1,e=!0){var s=n.height,i=n.width,l=n.data,d=0,c=128,u=64,h=1,f=128,p=64,m=[];function g(b,_){if(l[(s-1-b)*i*4+_*4+d]!=0||l[(s-1-b)*i*4+_*4+h]!=0)for(m[m.length]=[[_,b]];;)if(l[(s-1-b)*i*4+_*4+d]&c)l[(s-1-b)*i*4+_*4+d]=l[(s-1-b)*i*4+_*4+d]&~c,b+=1,m[m.length-1][m[m.length-1].length]=[_,b];else if(l[(s-1-b)*i*4+_*4+d]&u)l[(s-1-b)*i*4+_*4+d]=l[(s-1-b)*i*4+_*4+d]&~u,b-=1,m[m.length-1][m[m.length-1].length]=[_,b];else if(l[(s-1-b)*i*4+_*4+h]&f)l[(s-1-b)*i*4+_*4+h]=l[(s-1-b)*i*4+_*4+h]&~f,_+=1,m[m.length-1][m[m.length-1].length]=[_,b];else if(l[(s-1-b)*i*4+_*4+h]&p)l[(s-1-b)*i*4+_*4+h]=l[(s-1-b)*i*4+_*4+h]&~p,_-=1,m[m.length-1][m[m.length-1].length]=[_,b];else break}for(var r=1;r<s-1;++r)a=0,g(r,a),a=i-1,g(r,a);for(var a=1;a<i-1;++a)r=0,g(r,a),r=s-1,g(r,a);for(var r=1;r<s-1;++r)for(var a=1;a<i-1;++a)g(r,a);for(var y=t,v=[],$=0;$<m.length;++$){var w=m[$][0][0],A=m[$][0][1];v[v.length]=[[w,A]];for(var E=w,I=A,M=1,R=1;R<m[$].length;++R){var z=C,at=S,C=m[$][R][0],S=m[$][R][1];if(M==1)E+=C,I+=S,M+=1;else{var le=E/M,ce=I/M,lt=le-w,ct=ce-A,L=Math.sqrt(lt*lt+ct*ct),ue=ct/L,de=-lt/L,fe=Math.abs(ue*(C-w)+de*(S-A));fe<y?(E+=C,I+=S,M+=1):(v[v.length-1][v[v.length-1].length]=[z,at],w=z,A=at,E=z,I=at,M=1)}R==m[$].length-1&&(v[v.length-1][v[v.length-1].length]=[C,S])}}if(v.length>1&&e==!0){for(var Y=i*i+s*s,B=null,$=0;$<v.length;++$){var C=v[$][0][0],S=v[$][0][0],L=C*C+S*S;L<Y&&(Y=L,B=$)}if(B!=null){var k=[v[B]];v.splice(B,1)}for(;v.length>0;){var Y=i*i+s*s,w=k[k.length-1][k[k.length-1].length-1][0],A=k[k.length-1][k[k.length-1].length-1][1];B=null;for(var $=0;$<v.length;++$){var C=v[$][0][0],S=v[$][0][1],L=(C-w)*(C-w)+(S-A)*(S-A);L<Y&&(Y=L,B=$)}B!=null&&(k[k.length]=v[B],v.splice(B,1))}}else v.length>1&&e==!1||v.length==1?k=v:k=[];return console.log("rez",k),k}self.onmessage=function(n){const t=n.data;console.log("workerInternal.onmessage",t),buf=o(t.img,t.vectorFit,t.sort),self.postMessage([buf]),self.close()}}const Me={name:"img vectorize",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"vectorFit",type:"number",input:"box"},{name:"sort",type:"boolean",input:"check"}],outputs:[{name:"paths",type:"path"}],onUpdate(o,n){const t=o.outputs[0];return document.querySelector(`[data-id="${n}"] > .node-view`),`
      <div><span>paths</span> <span>${t.length}</span></div>
    `},func:async(o,n,t)=>{console.log("Vectorize Sort",t);const e=new Blob(["("+Se.toString()+"())"]),s=window.URL.createObjectURL(e),i=new Worker(s);console.log("after new Worker");const l=new Promise(d=>{i.onmessage=c=>{console.log("receive worker.onmessage",c.data[0]),d(c.data[0])}});return console.log("work,postMessage"),n==0&&(n=1),i.postMessage({img:o,vectorFit:n,sort:t}),await Promise.all([l])}},Be={name:"img viewer",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.inputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:o=>[o]},Ue={name:"number",inputs:[{name:"inputNum",type:"number",input:"box"}],outputs:[{name:"outputNum",type:"number"}],onUpdate(o){return`value: ${o.inputs[0]}`},func(o){return[o]}},Ie={name:"path viewer",inputs:[{name:"paths",type:"paths"}],outputs:[],onUpdate(o){const n=(i,l,d)=>{const c=(h,f,p)=>p===0?[...h,[[0,0],f[0],f[f.length-1]]]:[...h,[h[p-1][2],f[0],f[f.length-1]]];return i.reduce(c,[]).map(h=>h.slice(0,2)).map(h=>t(h,l,d,"red"))},t=(i,l,d,c="black")=>`<path d="${`M ${i.map(h=>`${h[0]} ${d-h[1]}`).join(",")}`}" fill="none" stroke="${c}"></path>`,e=(i,l,d)=>{const c=i.map(h=>t(h,l,d)),u=n(i,l,d);return[...c,...u]};return o.inputs[0]?`<svg viewBox="0 0 500 500">${e(o.inputs[0],100,100)}</svg>`:void 0},func:(o,n)=>[o+n]};function Le(){self.onmessage=function(o){const n=o.data;self.postMessage(n[0]+n[1]+100),self.close()}}const Re={name:"web worker example",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],outputs:[{name:"sum",type:"number"}],onUpdate(o){},func:async(o,n)=>{const t=new Blob(["("+Le.toString()+"())"]),e=window.URL.createObjectURL(t),s=new Worker(e),i=new Promise(l=>{s.onmessage=d=>{const c=d.data;l(c)}});return s.postMessage([o,n]),await Promise.all([i])}};class Pe extends Map{set(n,t){return super.set(n,t),t}}class Xt extends WeakMap{set(n,t){return super.set(n,t),t}}/*! (c) Andrea Giammarchi - ISC */const De=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,He=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,Oe=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,je=/[\x01\x02]/g,qe=(o,n,t)=>{let e=0;return o.join("").trim().replace(He,(s,i,l,d)=>{let c=i+l.replace(Oe,"=$2$1").trimEnd();return d.length&&(c+=t||De.test(i)?" /":"></"+i),"<"+c+">"}).replace(je,s=>s===""?"<!--"+n+e+++"-->":n+e++)},Fe=1,Zt=111,Ge=({firstChild:o,lastChild:n})=>{const t=document.createRange();return t.setStartAfter(o),t.setEndAfter(n),t.deleteContents(),o},We=(o,n)=>o.nodeType===Zt?1/n<0?n?Ge(o):o.lastChild:n?o.valueOf():o.firstChild:o,ze=o=>{const{firstChild:n,lastChild:t}=o;if(n===t)return t||o;const{childNodes:e}=o,s=[...e];return{ELEMENT_NODE:Fe,nodeType:Zt,firstChild:n,lastChild:t,valueOf(){return e.length!==s.length&&o.append(...s),o}}},{isArray:Ye}=Array,Ke=o=>n=>{for(const t in n){const e=t==="role"?t:`aria-${t}`,s=n[t];s==null?o.removeAttribute(e):o.setAttribute(e,s)}},wt=o=>o==null?o:o.valueOf(),Xe=(o,n)=>{let t,e=!0;const s=document.createAttributeNS(null,n);return i=>{const l=wt(i);t!==l&&((t=l)==null?e||(o.removeAttributeNode(s),e=!0):(s.value=l,e&&(o.setAttributeNodeNS(s),e=!1)))}},Ze=(o,n,t)=>e=>{const s=!!wt(e);t!==s&&((t=s)?o.setAttribute(n,""):o.removeAttribute(n))},Je=({dataset:o})=>n=>{for(const t in n){const e=n[t];e==null?delete o[t]:o[t]=e}},Ct=(o,n)=>{let t,e,s=n.slice(2);return!(n in o)&&(e=n.toLowerCase())in o&&(s=e.slice(2)),i=>{const l=Ye(i)?i:[i,!1];t!==l[0]&&(t&&o.removeEventListener(s,t,l[1]),(t=l[0])&&o.addEventListener(s,t,l[1]))}},Qe=o=>{let n;return t=>{n!==t&&(n=t,typeof t=="function"?t(o):t.current=o)}},Ve=(o,n)=>n==="dataset"?Je(o):t=>{o[n]=t},tn=o=>{let n;return t=>{const e=wt(t);n!=e&&(n=e,o.textContent=e==null?"":e)}},en=(o,n,t,e,s)=>{const i=t.length;let l=n.length,d=i,c=0,u=0,h=null;for(;c<l||u<d;)if(l===c){const f=d<i?u?e(t[u-1],-0).nextSibling:e(t[d-u],0):s;for(;u<d;)o.insertBefore(e(t[u++],1),f)}else if(d===u)for(;c<l;)(!h||!h.has(n[c]))&&o.removeChild(e(n[c],-1)),c++;else if(n[c]===t[u])c++,u++;else if(n[l-1]===t[d-1])l--,d--;else if(n[c]===t[d-1]&&t[u]===n[l-1]){const f=e(n[--l],-1).nextSibling;o.insertBefore(e(t[u++],1),e(n[c++],-1).nextSibling),o.insertBefore(e(t[--d],1),f),n[l]=t[d]}else{if(!h){h=new Map;let f=u;for(;f<d;)h.set(t[f],f++)}if(h.has(n[c])){const f=h.get(n[c]);if(u<f&&f<d){let p=c,m=1;for(;++p<l&&p<d&&h.get(n[p])===f+m;)m++;if(m>f-u){const g=e(n[c],0);for(;u<f;)o.insertBefore(e(t[u++],1),g)}else o.replaceChild(e(t[u++],1),e(n[c++],-1))}else c++}else o.removeChild(e(n[c++],-1))}return t},{isArray:Jt,prototype:nn}=Array,{indexOf:sn}=nn,{createDocumentFragment:on,createElement:rn,createElementNS:an,createTextNode:ln,createTreeWalker:cn,importNode:un}=new Proxy({},{get:(o,n)=>document[n].bind(document)}),dn=o=>{const n=rn("template");return n.innerHTML=o,n.content};let st;const fn=o=>{st||(st=an("http://www.w3.org/2000/svg","svg")),st.innerHTML=o;const n=on();return n.append(...st.childNodes),n},hn=(o,n)=>n?fn(o):dn(o),pn=({childNodes:o},n)=>o[n],X=(o,n,t)=>en(o.parentNode,n,t,We,o),mn=o=>{let n,t,e=[];const s=i=>{switch(typeof i){case"string":case"number":case"boolean":n!==i&&(n=i,t||(t=ln("")),t.data=i,e=X(o,e,[t]));break;case"object":case"undefined":if(i==null){n!=i&&(n=i,e=X(o,e,[]));break}if(Jt(i)){n=i,i.length===0?e=X(o,e,[]):typeof i[0]=="object"?e=X(o,e,i):s(String(i));break}if(n!==i)if("ELEMENT_NODE"in i)n=i,e=X(o,e,i.nodeType===11?[...i.childNodes]:[i]);else{const l=i.valueOf();l!==i&&s(l)}break;case"function":s(i(o));break}};return s},gn=(o,n)=>{switch(n[0]){case"?":return Ze(o,n.slice(1),!1);case".":return Ve(o,n.slice(1));case"@":return Ct(o,"on"+n.slice(1));case"o":if(n[1]==="n")return Ct(o,n)}switch(n){case"ref":return Qe(o);case"aria":return Ke(o)}return Xe(o,n)};function vn(o){const{type:n,path:t}=o,e=t.reduceRight(pn,this);return n==="node"?mn(e):n==="attr"?gn(e,o.name):tn(e)}const ft=o=>{const n=[];let{parentNode:t}=o;for(;t;)n.push(sn.call(t.childNodes,o)),o=t,{parentNode:t}=o;return n},Z="is\xB5",St=new Xt,yn=/^(?:textarea|script|style|title|plaintext|xmp)$/,rt=()=>({stack:[],entry:null,wire:null}),$n=(o,n)=>{const{content:t,updates:e}=An(o,n);return{type:o,template:n,content:t,updates:e,wire:null}},wn=(o,n)=>{const t=o==="svg",e=qe(n,Z,t),s=hn(e,t),i=cn(s,129),l=[],d=n.length-1;let c=0,u=`${Z}${c}`;for(;c<d;){const h=i.nextNode();if(!h)throw`bad template: ${e}`;if(h.nodeType===8)h.data===u&&(l.push({type:"node",path:ft(h)}),u=`${Z}${++c}`);else{for(;h.hasAttribute(u);)l.push({type:"attr",path:ft(h),name:h.getAttribute(u)}),h.removeAttribute(u),u=`${Z}${++c}`;yn.test(h.localName)&&h.textContent.trim()===`<!--${u}-->`&&(h.textContent="",l.push({type:"text",path:ft(h)}),u=`${Z}${++c}`)}}return{content:s,nodes:l}},An=(o,n)=>{const{content:t,nodes:e}=St.get(n)||St.set(n,wn(o,n)),s=un(t,!0),i=e.map(vn,s);return{content:s,updates:i}},mt=(o,{type:n,template:t,values:e})=>{const s=Qt(o,e);let{entry:i}=o;(!i||i.template!==t||i.type!==n)&&(o.entry=i=$n(n,t));const{content:l,updates:d,wire:c}=i;for(let u=0;u<s;u++)d[u](e[u]);return c||(i.wire=ze(l))},Qt=({stack:o},n)=>{const{length:t}=n;for(let e=0;e<t;e++){const s=n[e];s instanceof gt?n[e]=mt(o[e]||(o[e]=rt()),s):Jt(s)?Qt(o[e]||(o[e]=rt()),s):o[e]=null}return t<o.length&&o.splice(t),t};class gt{constructor(n,t,e){this.type=n,this.template=t,this.values=e}}const Vt=o=>{const n=new Xt,t=e=>(s,...i)=>mt(e,{type:o,template:s,values:i});return Object.assign((e,...s)=>new gt(o,e,s),{for(e,s){const i=n.get(e)||n.set(e,new Pe);return i.get(s)||i.set(s,t(rt()))},node:(e,...s)=>mt(rt(),new gt(o,e,s)).valueOf()})},te=Vt("html");Vt("svg");const bn={name:"web serial",inputs:[],outputs:[],onUpdate(o){return te.node`
      <button @click=${_n}>ports</button>
    `},func:(o,n)=>[o+n]};async function _n(){const o=await navigator.serial.getPorts();console.log("ports",o)}const xn={name:"web socket",inputs:[{name:"msg",type:"string",input:"box"}],outputs:[],onUpdate(o){return te.node`
      <button @click=${()=>Nn(o.state)}>start socket</button>
    `},func:o=>(console.log(o),[])};function Nn(o){var n=new WebSocket("ws://localhost:3000");n.onopen=()=>{n.send("r"),o.count++},n.onclose=function(){console.log("web socket closed")}}const G={adder:ve,async_adder:ye,img_distance:we,img_edge_detect:be,img_offset:xe,img_read_png:Ne,img_sample:Te,img_threshold:Ce,img_vectorize:Me,img_viewer:Be,number:Ue,path_viewer:Ie,worker_example:Re,webSerial:bn,webSocket:xn},x={nodeTypes:G,nodes:{fds:{type:"number",x:150,y:0,inputs:[0],outputs:[42],evaluated:[!1]},fsa:{type:"number",x:30,y:0,inputs:[0],outputs:[43],evaluated:[!1]},dsf:{type:"adder",x:100,y:100,inputs:[0,0],outputs:[42],evaluated:[!1]}},connections:[["fsa:out:0","dsf:in:0"],["fsa:out:0","fds:in:0"],["fds:out:0","dsf:in:1"]],selectedNodes:[],tempEdge:["",[0,0]],dataflow:null,name:"default-name"};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const kn={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Tn=o=>(...n)=>({_$litDirective$:o,values:n});class En{constructor(n){}get _$AU(){return this._$AM._$AU}_$AT(n,t,e){this._$Ct=n,this._$AM=t,this._$Ci=e}_$AS(n,t){return this.update(n,t)}update(n,t){return this.render(...t)}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{I:Cn}=me,Mt=()=>document.createComment(""),J=(o,n,t)=>{var e;const s=o._$AA.parentNode,i=n===void 0?o._$AB:n._$AA;if(t===void 0){const l=s.insertBefore(Mt(),i),d=s.insertBefore(Mt(),i);t=new Cn(l,d,o,o.options)}else{const l=t._$AB.nextSibling,d=t._$AM,c=d!==o;if(c){let u;(e=t._$AQ)===null||e===void 0||e.call(t,o),t._$AM=o,t._$AP!==void 0&&(u=o._$AU)!==d._$AU&&t._$AP(u)}if(l!==i||c){let u=t._$AA;for(;u!==l;){const h=u.nextSibling;s.insertBefore(u,i),u=h}}}return t},D=(o,n,t=o)=>(o._$AI(n,t),o),Sn={},Mn=(o,n=Sn)=>o._$AH=n,Bn=o=>o._$AH,ht=o=>{var n;(n=o._$AP)===null||n===void 0||n.call(o,!1,!0);let t=o._$AA;const e=o._$AB.nextSibling;for(;t!==e;){const s=t.nextSibling;t.remove(),t=s}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Bt=(o,n,t)=>{const e=new Map;for(let s=n;s<=t;s++)e.set(o[s],s);return e},Un=Tn(class extends En{constructor(o){if(super(o),o.type!==kn.CHILD)throw Error("repeat() can only be used in text expressions")}ct(o,n,t){let e;t===void 0?t=n:n!==void 0&&(e=n);const s=[],i=[];let l=0;for(const d of o)s[l]=e?e(d,l):l,i[l]=t(d,l),l++;return{values:i,keys:s}}render(o,n,t){return this.ct(o,n,t).values}update(o,[n,t,e]){var s;const i=Bn(o),{values:l,keys:d}=this.ct(n,t,e);if(!Array.isArray(i))return this.ut=d,l;const c=(s=this.ut)!==null&&s!==void 0?s:this.ut=[],u=[];let h,f,p=0,m=i.length-1,g=0,r=l.length-1;for(;p<=m&&g<=r;)if(i[p]===null)p++;else if(i[m]===null)m--;else if(c[p]===d[g])u[g]=D(i[p],l[g]),p++,g++;else if(c[m]===d[r])u[r]=D(i[m],l[r]),m--,r--;else if(c[p]===d[r])u[r]=D(i[p],l[r]),J(o,u[r+1],i[p]),p++,r--;else if(c[m]===d[g])u[g]=D(i[m],l[g]),J(o,i[p],i[m]),m--,g++;else if(h===void 0&&(h=Bt(d,g,r),f=Bt(c,p,m)),h.has(c[p]))if(h.has(c[m])){const a=f.get(d[g]),y=a!==void 0?i[a]:null;if(y===null){const v=J(o,i[p]);D(v,l[g]),u[g]=v}else u[g]=D(y,l[g]),J(o,i[p],y),i[a]=null;g++}else ht(i[m]),m--;else ht(i[p]),p++;for(;g<=r;){const a=J(o,u[r+1]);D(a,l[g]),u[g++]=a}for(;p<=m;){const a=i[p++];a!==null&&ht(a)}return this.ut=d,Mn(o,u),F}});function In(o,n,t,e,s,i){const l=o.target.files;d(l);function d(h,f=[]){let p=h[0],m=p.name.split(".");if(m[0],m[m.length-1],f.length>0&&f.includes(enxtension))throw"Extension not recongized: "+m;c(p)}function c(h){if(G[n.type].inputs[i].type==="img_uint8"){const m=new FileReader;m.readAsDataURL(h),m.onloadend=u}}function u(h){var f=new Image;f.setAttribute("src",h.target.result),f.onload=function(){const p=document.createElement("canvas");if(p.height=f.height,p.width=f.width,f.width>f.height)var m=0,g=p.height*.5*(1-f.height/f.width),r=p.width,a=p.width*f.height/f.width;else var m=p.width*.5*(1-f.width/f.height),g=0,r=p.height*f.width/f.height,a=p.height;var y=p.getContext("2d");y.clearRect(0,0,p.width,p.height),y.drawImage(f,m,g,r,a);var y=p.getContext("2d");y.canvas.width=f.width,y.canvas.height=f.height,y.drawImage(f,0,0);const v=y.getImageData(0,0,y.canvas.width,y.canvas.height);n.inputs[i]={data:v.data,width:v.width,height:v.height}}}}function Ln(o){x.connections=x.connections.filter(([n,t])=>!n.includes(o)&&!t.includes(o)),delete x.nodes[o],x.selectedNodes=x.selectedNodes.filter(n=>n!==o)}async function Rn(o,n,t,e){function s(){const f=Object.keys(n),p={};return f.forEach(m=>p[m]=-1),l(p)(o,0),p}function i(f,p,m){return m.indexOf(f)===p}const l=f=>(p,m)=>{f[p]=m++,t.filter(([r,a])=>a.includes(p)).map(r=>r[0].split(":")[0]).filter(i).forEach(r=>l(f)(r,m))},d=f=>{let p=[];for(const m in f){const g=f[m];if(!(g<0)){for(;p.length<=g;)p.push([]);p[g].push(m)}}return p=p.reverse(),p},c=async f=>{const p=n[f],m=p.type,g=e[m],r=g.func,a=p.inputs.map((w,A)=>`${f}:in:${A}`),y={};t.forEach(w=>{y[w[1]]=w[0]}),a.forEach(w=>{if(w in y){const A=w.split(":")[2],E=y[w],[I,M,R]=E.split(":"),z=n[I].outputs[R];p.inputs[A]=z}});const v=g.inputs.map(w=>w.type);p.inputs.forEach((w,A)=>{v[A]==="number"&&(p.inputs[A]=Number(w))});const $=await r(...p.inputs);return p.outputs=$,$},u=s(),h=d(u);for(let f of h){const p=f.map(c);await Promise.all(p),f.forEach(m=>{const g=n[m],r=g.type,a=e[r];if(a.func,!a.onUpdate)return;const y=a.onUpdate(g),v=document.querySelector(`[data-id="${m}"] > .node-view`);if(typeof y=="string")v.innerHTML=y;else{for(;v.firstChild;)v.removeChild(v.lastChild);v.append(y)}})}}function ee(o){Rn(o,x.nodes,x.connections,x.nodeTypes).then(()=>{})}const vt={number:0,string:"",img_uint8:Pn(),img_float32:{data:new Float32Array(1),width:1,height:1},boolean:!0,path:[]};function Pn(){const t=new Uint8ClampedArray(4e4);for(let e=0;e<100;e++)for(let s=0;s<100;s++)t[(e*100+s)*4]=e*255/100,t[(e*100+s)*4+1]=s*255/100,t[(e*100+s)*4+2]=0,t[(e*100+s)*4+3]=255;return{data:t,width:100,height:100}}function Ut(o,n){const t={img_uint8:e=>({data:btoa(e.data.reduce((s,i)=>s+String.fromCharCode(i),"")),width:e.width,height:e.height})};return o in t?t[o](n):n}function It(o,n){const t={img_uint8:e=>({data:Dn(e.data),width:e.width,height:e.height})};return o in t?t[o](n):n}const Dn=o=>{const n=atob(o),t=n.length,e=new Uint8ClampedArray(t);for(let s=0;s<t;s++){const l=n[s].charCodeAt(0);e[s]=l}return e};function Hn({nodes:o,connections:n,name:t}){const e={nodes:{},connections:n,name:t};for(const s in o){const i={},l=o[s];i.x=l.x,i.y=l.y,i.type=l.type,i.inputs=[],i.outputs=[],i.evaluated=[];const d=l.type,c=G[d].inputs.map(h=>h.type),u=G[d].outputs.map(h=>h.type);c.forEach((h,f)=>{const p=l.inputs[f];i.inputs[f]=Ut(h,p)}),u.forEach((h,f)=>{const p=vt[h];i.outputs[f]=Ut(h,p),i.evaluated[f]=!1}),e.nodes[s]=i}return JSON.stringify(e)}function On(o){const n=JSON.parse(o),t=n.nodes;for(const e in t){const s={},i=t[e];s.x=i.x,s.y=i.y,s.type=i.type,s.inputs=[],s.outputs=[],s.evaluated=[];const l=i.type,d=G[l].inputs.map(u=>u.type),c=G[l].outputs.map(u=>u.type);d.forEach((u,h)=>{const f=i.inputs[h];s.inputs[h]=It(u,f)}),c.forEach((u,h)=>{const f=i.outputs[h];s.outputs[h]=It(u,f),s.evaluated[h]=!1}),t[e]=s}return n}function jn(o,n){const t=new Blob([n],{type:"text/plain"}),e=document.createElement("a");e.href=URL.createObjectURL(t),e.download=`${o}`,e.click(),URL.revokeObjectURL(e)}function qn(){const{nodes:o,connections:n,name:t}=x,e=Hn({nodes:o,connections:n,name:t});jn(`${x.name}.json`,e)}function Fn(o){return o=o.replaceAll(" ","-"),o===""&&(o="defaultName"),o}function Gn(o){x.name=Fn(o)}function ne(o){const{nodes:n,connections:t,name:e}=On(o);x.nodes=n,x.connections=t,x.name=e}const Wn=o=>T`
  <div class="toolbox-node" data-type=${o}>
    ${o}
  </div>
`,zn=(o,n,t)=>T`
  <div class="node-input">
    <div
      class=${["node-input-circle","socket",["upload"].includes(t.input)?"hide-socket":""].join(" ")}
      data-id=${`${o}:in:${n}`}></div>
    <div class="node-input-name">${t.name}</div>
  </div>
`,Yn=(o,n,t)=>T`
  <div class="node-output">
    <div class="node-output-name">${t.name}</div>
    <div
      class="node-output-circle socket"
      data-id=${`${o}:out:${n}`}></div>
  </div>
`,Kn=(o,n)=>{const[t,e]=o,s=n.nodeTypes[e.type];if(!s)throw["The node type '",e.type,"' isn't a known one (name change?): ",Object.keys(n.nodeTypes)].join("");const i=n.selectedNodes.includes(t);return T`
    <div
      class=${["node",i?"selected-node":""].join(" ")}
      data-id=${t}
      style=${`left: ${e.x}px; top: ${e.y}px;`}>
      <div class="node-title">
        <div class="node-name">${s.name}</div>
        <div class="node-buttons">
          <div class="node-play" @click=${l=>ee(t)}>►</div>
          <div class="node-delete" @click=${l=>Ln(t)}>x</div>
        </div>
      </div>
      ${s.inputs.map((l,d)=>zn(t,d,l))}
      ${s.outputs.map((l,d)=>Yn(t,d,l))}
      <div class="node-view"></div>
    </div>
  `};function Xn(o,n){const{nodes:t}=n,[e,s]=o.map(v=>v.split(":")[0]),[i,l]=o.map(v=>Number(v.split(":")[2])),{x:d,y:c,inputs:u}=t[e],{x:h,y:f}=t[s];if(n.dataflow===null)return;const p=(d+190)*n.dataflow.scale()+n.dataflow.x(),m=(c+37+18.5*(i+u.length))*n.dataflow.scale()+n.dataflow.y(),g=h*n.dataflow.scale()+n.dataflow.x(),r=(f+37+18.5*l)*n.dataflow.scale()+n.dataflow.y();let a=Math.abs(p-g);a=a/1.3;const y=`M ${p} ${m} C ${p+a} ${m}, ${g-a} ${r}, ${g} ${r}`;return pt`
    <path class="edge" stroke-width=${`${3*n.dataflow.scale()}px`} vector-effect="non-scaling-stroke" d=${y}/>
  `}function Zn(o,n){if(!document.querySelector(".socket"))return;const[t,[e,s]]=o;if(t===""||n.dataflow===null)return pt``;const{x:i,y:l,inputs:d}=n.nodes[t.split(":")[0]],c=Number(t.split(":")[2]),u=(i+190)*n.dataflow.scale()+n.dataflow.x(),h=(l+37+18.5*(c+d.length))*n.dataflow.scale()+n.dataflow.y();let f=Math.abs(u-e);f=f/1.3;const p=`M ${u} ${h} C ${u+f} ${h}, ${e-f} ${s}, ${e} ${s}`;return pt`
    <path class="edge" stroke-width=${`${3*n.dataflow.scale()}px`} vector-effect="non-scaling-stroke" d=${p}>
  `}const Jn=o=>!o||!o.start||!o.end?"":T`
    <div
      class="select-box"
      style=${`
        background: blue;
        opacity: 0.1;
        z-index: 100;
        position: absolute;
        left: ${o.start[0]}px;
        top:${o.start[1]}px;
        width: ${Math.abs(o.end[0]-o.start[0])}px;
        height:${Math.abs(o.end[1]-o.start[1])}px;
      `}>
    </div>
  `;function Qn(o){const n=o.selectedNodes[0],t=o.nodes[n],e=o.nodeTypes[t.type],s=(d,c)=>{t.inputs[c]=d},i={box:(d,c,u,h)=>T`
      <div class="node-editor-input">
        <span>${d}:</span>
        <input
          .value=${c}
          .disabled=${u}
          @blur=${yt}
          @input=${f=>s(f.target.value,h)}/>
      </div>
    `,check:(d,c,u,h)=>T`
      <div class="node-editor-input">
        <span>${d}:</span>
        <input
          type=checkbox
          .checked=${c?"checked":""}
          .disabled=${u}
          @blur=${yt}
          @input=${f=>s(!!f.target.checked,h)}/>
      </div>
    `,upload:(d,c,u,h)=>T`
      <div class="node-editor-input">
        <input type="file" @change=${f=>In(f,t,d,c,u,h)}/>
      </div>
    `},l=(d,c)=>{const u=o.connections.some(([f,p])=>p===`${n}:in:${c}`);return d.input&&d.input in i?i[d.input](d.name,t.inputs[c],u,c):T``};return T`
    <div class="node-editor-name">${t.type}</div>
    ${e.inputs.map(l)}
  `}function Vn(o){var e;let n=((e=document.querySelector(".toolbox-search"))==null?void 0:e.value)||"";n=n.toLowerCase();const t=Object.keys(o.nodeTypes).filter(s=>s.toLowerCase().includes(n));return T`
    <div class="root">
      <div class="menu">
        <div 
          class="menu-item menu-name" 
          contenteditable 
          spellcheck="false"
          @blur=${s=>Gn(s.target.innerText)}>${o.name}</div>
        <div class="menu-item" @click=${()=>qn()}>save</div>
        <div class="menu-item" @click=${()=>document.getElementById("load_file").click()}>load</div>
        <!-- hidden -->
        <input type="file" accept=".json" style="display:none;" id="load_file" name="file" @input=${s=>{const i=s.target.files[0];ts(i).then(l=>ne(l))}}>

        <div class="menu-item dropdown-container">
          list menu
          <div class="dropdown-list">
            <span>
              option 1
            </span>
            <span>
              option 2
            </span>
          </div>
        </div>
        <a class="menu-item" href="https://github.com/leomcelroy/yada" target="_blank">github</a>
      </div>
      <div class="bottom-container">
        <div class="toolbox">
          <div class="toolbox-search-container">
            <input class="toolbox-search" @input=${yt}></input>
            <div class="toolbox-search-results">
              ${t.map(Wn)}
            </div>
          </div>
          ${o.selectedNodes.length===1?T`<div class="node-input-editor">
                  ${Qn(o)}
                  <div>state: ${JSON.stringify(o.nodes[o.selectedNodes[0]].state)}</div>
                </div>`:""}
        </div>
        <div class="dataflow">
          <svg class="edges">
            <g>
              ${o.connections.map(s=>Xn(s,o))}
              ${Zn(o.tempEdge,o)}
            </g>
          </svg>
          <div class="nodes">
            <div class="transform-group">
              ${Un(Object.entries(o.nodes),s=>s[0],s=>Kn(s,o))}
              
              ${Jn(o.selectBox)}
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function ts(o){return new Promise((n,t)=>{let e=new FileReader;e.onload=s=>n(e.result),e.readAsText(o)})}const yt=()=>{},Lt=(o,n)=>{let t=document.querySelector(n).getBoundingClientRect(),e=o.clientX-t.left,s=o.clientY-t.top;return[e,s]};function es(o,n){let t=null,e=null;const s=n.dataflow;n.selectBox={start:[0,0],end:[0,0]},o("mousedown",".nodes",l=>{if(!l.shiftKey)return;const[d,c]=Lt(l,".dataflow");t=s.getPoint(d,c)}),o("mousemove","",l=>{if(document.body.classList.add("no-select"),!l.shiftKey||t===null)return;const[d,c]=Lt(l,".dataflow");e=s.getPoint(d,c),n.selectBox.start=[Math.min(t[0],e[0]),Math.min(t[1],e[1])],n.selectBox.end=[Math.max(t[0],e[0]),Math.max(t[1],e[1])]});function i(l,d){let{start:c,end:u}=d;return l.x>c.x&&l.x<u.x&&l.y>c.y&&l.y<u.y||l.x>c.x&&l.x<u.x&&l.y<c.y&&l.y>u.y||l.x<c.x&&l.x>u.x&&l.y>c.y&&l.y<u.y||l.x<c.x&&l.x>u.x&&l.y<c.y&&l.y>u.y}o("mouseup","",l=>{!l.shiftKey||(document.body.classList.remove("no-select"),t&&e&&Object.entries(n.nodes).forEach(([d,c])=>{i(c,{start:{x:t[0],y:t[1]},end:{x:e[0],y:e[1]}})&&!n.selectedNodes.includes(d)&&n.selectedNodes.push(d)}),t=null,e=null,n.selectBox.start=t,n.selectBox.end=e)})}function ns(o,n=[]){let t=o[0],e=t.name.split(".");if(e[0],e[e.length-1],n.length>0&&n.includes(enxtension))throw"Extension not recongized: "+e;ss(t)}function ss(o){var n=new FileReader;n.readAsText(o),n.onloadend=t=>{const e=n.result;try{ne(e)}catch{}}}function os(o,n){o("drop","",function(t){let s=t.dataTransfer.files;ns(s),Rt(t)}),o("dragover","",function(t){Rt(t)})}function Rt(o){return o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.cancelBubble=!0,o.returnValue=!1,!1}const se=o=>o.composedPath()[0],is=(o,n)=>se(o).matches(n),rs=o=>(n,t,e)=>{o.addEventListener(n,s=>{s.trigger=se(s),(t===""||is(s,t))&&e(s)})};function as(o){let n=!1;const t=r=>{n=r},e=rs(o),s=o.querySelectorAll(".transform-group"),i=r=>{let a=o.getBoundingClientRect(),y=r.clientX-a.left,v=r.clientY-a.top;return[y,v]};let l=!1,d=1,c=0,u=0,h={x:0,y:0};function f(r){r.forEach(a=>{a.style.transformOrigin=`${0}px ${0}px`,a.style.transform="translate("+c+"px, "+u+"px) scale("+d+")"})}function p(r,a){let y=(r-c)/d,v=(a-u)/d;return[y,v]}e("mousedown","",r=>{if(n||r.shiftKey)return;const[a,y]=i(r);l=!0,h={x:a-c,y:y-u},r.detail===2&&console.log(a,y,p(a,y))}),e("mousemove","",r=>{if(n||!l)return;const[a,y]=i(r);c=a-h.x,u=y-h.y,f(s)}),e("mouseup","",r=>{l=!1}),e("mouseout","",r=>{l=!1}),e("wheel","",r=>{const[a,y]=i(r);let v=(a-c)/d,$=(y-u)/d;Math.sign(r.deltaY)<0?d*=1.03:d/=1.03,c=a-v*d,u=y-$*d,f(s),r.preventDefault()});function m(r){const a=o.getBoundingClientRect(),y=r.x[1]-r.x[0],v=r.y[1]-r.y[0],$=a.width/y,w=a.height/v,A=Math.min($,w)*.9;d=A;const E={x:(r.x[0]+r.x[1])/2*A-a.width/2,y:(r.y[0]+r.y[1])/2*A-a.height/2};c=-E.x,u=-E.y,f(s)}function g(){if(o===null)return null;const{left:r,right:a,bottom:y,top:v,width:$,height:w}=o.getBoundingClientRect(),A=p($,w),E=p(0,w),I=p($,0),M=p(0,0);return{rt:A,lt:E,rb:I,lb:M}}return{scale:()=>d,x:()=>c,y:()=>u,corners:g,getPoint:p,setScaleXY:m,togglePanZoom:t}}function Pt(o){x.connections=x.connections.filter((n,t)=>t!==o)}function ls(o,n){x.connections.push([o,n])}function cs(o,n,t){const e=x.nodes[o];!e||(e.x+=n,e.y+=t)}const oe=o=>o.composedPath()[0],us=(o,n)=>oe(o).matches(n),Q=(o,n)=>o.composedPath().some(t=>t.matches&&t.matches(n)),ds=o=>(n,t,e)=>{o.addEventListener(n,s=>{s.trigger=oe(s),(t===""||us(s,t))&&e(s)})};function fs(o,n){const t=document.querySelector(o),e=document.querySelector(n),s=t.getBoundingClientRect(),i=e.getBoundingClientRect(),l=s.top-i.top;return[s.left-i.left,l]}const ie=(o,n)=>{let t=document.querySelector(n).getBoundingClientRect(),e=o.clientX-t.left,s=o.clientY-t.top;return[e,s]};function hs(o,n){let t=!1,e="",s="";o("mousedown",".toolbox-node",i=>{s=i.target.dataset.type,t=!0,e=Math.random().toString(16).slice(2)}),o("mousemove","",i=>{if(!t)return;const[l,d]=n.dataflow.getPoint(...ie(i,".dataflow")),{inputs:c,outputs:u,state:h}=n.nodeTypes[s],f=c.map(m=>vt[m.type]),p=u.map(m=>vt[m.type]);n.nodes[e]={type:s,state:h,x:l,y:d,inputs:f,outputs:p,evaluated:new Array(p.length).fill(!1)}}),o("mouseup","",i=>{t&&Q(i,".toolbox")&&delete n.nodes[e],e!==""&&Q(i,".dataflow")&&ee(e),e="",t=!1})}function ps(o,n){let t="",e="",s=-1;o("mousedown",".node-input-circle",i=>{const l=i.target.dataset.id,d=n.connections.find(c=>c[1]===l);s=n.connections.findIndex(c=>c[1]===l),d&&(t=d[0])}),o("mousedown",".node-output-circle",i=>{t=i.target.dataset.id}),o("mouseup",".node-input-circle",i=>{e=i.target.dataset.id}),o("wheel","",i=>{}),o("mousemove","",i=>{t!==""&&(document.querySelector(`[data-id="${t}"]`).getBoundingClientRect(),fs(`[data-id="${t}"]`,".dataflow"),n.tempEdge=[t,ie(i,".dataflow")]),s!==-1&&(Pt(s),s=-1)}),o("mouseup","",i=>{t!==""&&(t!==""&&e!==""&&(s=n.connections.findIndex(l=>l[1]===e),s!==-1&&Pt(s),ls(t,e)),t="",e="",s=-1,n.tempEdge=["",[0,0]])})}function ms(o,n){let t=!1,e="";o("mousedown","",s=>{if(document.body.classList.add("no-select"),Q(s,".socket")){n.dataflow.togglePanZoom(!0);return}!Q(s,".dataflow")||(t=s.composedPath().find(i=>i.matches&&i.matches(".node")),Q(s,".node")?(n.dataflow.togglePanZoom(!0),e=t.dataset.id,n.selectedNodes.includes(e)&&s.detail===2||(!n.selectedNodes.includes(e)&&!s.shiftKey?n.selectedNodes=[e]:!n.selectedNodes.includes(e)&&s.shiftKey&&n.selectedNodes.push(e))):s.shiftKey||(n.selectedNodes=[]))}),o("mousemove","",s=>{if(!t)return;const i=n.dataflow.scale();n.selectedNodes.forEach(l=>{cs(l,s.movementX/i,s.movementY/i)})}),o("mouseup","",s=>{document.body.classList.remove("no-select"),t=!1,e="",n.dataflow.togglePanZoom(!1)})}function gs(){document.addEventListener("keydown",o=>{const n=[61,107,173,109,187,189];(o.ctrlKey||o.metaKey)&&n.some(t=>o.which===t)&&o.preventDefault()}),document.addEventListener("mousewheel",o=>{(o.ctrlKey||o.metaKey)&&o.preventDefault()})}function vs(o){o.dataflow=as(document.querySelector(".dataflow"));const n=document.querySelector("body"),t=ds(n);ms(t,o),ps(t,o),hs(t,o),es(t,o),os(t),gs()}const re=()=>ge(Vn(x),document.body);window.LOG_STATE=()=>console.log(x);const ae=o=>{re(),requestAnimationFrame(ae)};window.addEventListener("load",()=>{re(),vs(x),requestAnimationFrame(ae)});
