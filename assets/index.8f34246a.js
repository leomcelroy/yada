(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var ct;const ot=window,j=ot.trustedTypes,$t=j?j.createPolicy("lit-html",{createHTML:o=>o}):void 0,U=`lit$${(Math.random()+"").slice(9)}$`,vt="?"+U,ue=`<${vt}>`,q=document,V=(o="")=>q.createComment(o),tt=o=>o===null||typeof o!="object"&&typeof o!="function",Rt=Array.isArray,Pt=o=>Rt(o)||typeof(o==null?void 0:o[Symbol.iterator])=="function",K=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,wt=/-->/g,At=/>/g,P=RegExp(`>|[ 	
\f\r](?:([^\\s"'>=/]+)([ 	
\f\r]*=[ 	
\f\r]*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),bt=/'/g,xt=/"/g,Dt=/^(?:script|style|textarea|title)$/i,Ht=o=>(n,...t)=>({_$litType$:o,strings:n,values:t}),T=Ht(1),ft=Ht(2),F=Symbol.for("lit-noChange"),N=Symbol.for("lit-nothing"),_t=new WeakMap,O=q.createTreeWalker(q,129,null,!1),Ot=(o,n)=>{const t=o.length-1,e=[];let s,i=n===2?"<svg>":"",l=K;for(let u=0;u<t;u++){const c=o[u];let p,f,h=-1,m=0;for(;m<c.length&&(l.lastIndex=m,f=l.exec(c),f!==null);)m=l.lastIndex,l===K?f[1]==="!--"?l=wt:f[1]!==void 0?l=At:f[2]!==void 0?(Dt.test(f[2])&&(s=RegExp("</"+f[2],"g")),l=P):f[3]!==void 0&&(l=P):l===P?f[0]===">"?(l=s!=null?s:K,h=-1):f[1]===void 0?h=-2:(h=l.lastIndex-f[2].length,p=f[1],l=f[3]===void 0?P:f[3]==='"'?xt:bt):l===xt||l===bt?l=P:l===wt||l===At?l=K:(l=P,s=void 0);const g=l===P&&o[u+1].startsWith("/>")?" ":"";i+=l===K?c+ue:h>=0?(e.push(p),c.slice(0,h)+"$lit$"+c.slice(h)+U+g):c+U+(h===-2?(e.push(void 0),u):g)}const d=i+(o[t]||"<?>")+(n===2?"</svg>":"");if(!Array.isArray(o)||!o.hasOwnProperty("raw"))throw Error("invalid template strings array");return[$t!==void 0?$t.createHTML(d):d,e]};class et{constructor({strings:n,_$litType$:t},e){let s;this.parts=[];let i=0,l=0;const d=n.length-1,u=this.parts,[c,p]=Ot(n,t);if(this.el=et.createElement(c,e),O.currentNode=this.el.content,t===2){const f=this.el.content,h=f.firstChild;h.remove(),f.append(...h.childNodes)}for(;(s=O.nextNode())!==null&&u.length<d;){if(s.nodeType===1){if(s.hasAttributes()){const f=[];for(const h of s.getAttributeNames())if(h.endsWith("$lit$")||h.startsWith(U)){const m=p[l++];if(f.push(h),m!==void 0){const g=s.getAttribute(m.toLowerCase()+"$lit$").split(U),r=/([.?@])?(.*)/.exec(m);u.push({type:1,index:i,name:r[2],strings:g,ctor:r[1]==="."?qt:r[1]==="?"?Ft:r[1]==="@"?Gt:nt})}else u.push({type:6,index:i})}for(const h of f)s.removeAttribute(h)}if(Dt.test(s.tagName)){const f=s.textContent.split(U),h=f.length-1;if(h>0){s.textContent=j?j.emptyScript:"";for(let m=0;m<h;m++)s.append(f[m],V()),O.nextNode(),u.push({type:2,index:++i});s.append(f[h],V())}}}else if(s.nodeType===8)if(s.data===vt)u.push({type:2,index:i});else{let f=-1;for(;(f=s.data.indexOf(U,f+1))!==-1;)u.push({type:7,index:i}),f+=U.length-1}i++}}static createElement(n,t){const e=q.createElement("template");return e.innerHTML=n,e}}function H(o,n,t=o,e){var s,i,l,d;if(n===F)return n;let u=e!==void 0?(s=t._$Co)===null||s===void 0?void 0:s[e]:t._$Cl;const c=tt(n)?void 0:n._$litDirective$;return(u==null?void 0:u.constructor)!==c&&((i=u==null?void 0:u._$AO)===null||i===void 0||i.call(u,!1),c===void 0?u=void 0:(u=new c(o),u._$AT(o,t,e)),e!==void 0?((l=(d=t)._$Co)!==null&&l!==void 0?l:d._$Co=[])[e]=u:t._$Cl=u),u!==void 0&&(n=H(o,u._$AS(o,n.values),u,e)),n}class jt{constructor(n,t){this.u=[],this._$AN=void 0,this._$AD=n,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(n){var t;const{el:{content:e},parts:s}=this._$AD,i=((t=n==null?void 0:n.creationScope)!==null&&t!==void 0?t:q).importNode(e,!0);O.currentNode=i;let l=O.nextNode(),d=0,u=0,c=s[0];for(;c!==void 0;){if(d===c.index){let p;c.type===2?p=new W(l,l.nextSibling,this,n):c.type===1?p=new c.ctor(l,c.name,c.strings,this,n):c.type===6&&(p=new Wt(l,this,n)),this.u.push(p),c=s[++u]}d!==(c==null?void 0:c.index)&&(l=O.nextNode(),d++)}return i}p(n){let t=0;for(const e of this.u)e!==void 0&&(e.strings!==void 0?(e._$AI(n,e,t),t+=e.strings.length-2):e._$AI(n[t])),t++}}class W{constructor(n,t,e,s){var i;this.type=2,this._$AH=N,this._$AN=void 0,this._$AA=n,this._$AB=t,this._$AM=e,this.options=s,this._$Cm=(i=s==null?void 0:s.isConnected)===null||i===void 0||i}get _$AU(){var n,t;return(t=(n=this._$AM)===null||n===void 0?void 0:n._$AU)!==null&&t!==void 0?t:this._$Cm}get parentNode(){let n=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&n.nodeType===11&&(n=t.parentNode),n}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(n,t=this){n=H(this,n,t),tt(n)?n===N||n==null||n===""?(this._$AH!==N&&this._$AR(),this._$AH=N):n!==this._$AH&&n!==F&&this.g(n):n._$litType$!==void 0?this.$(n):n.nodeType!==void 0?this.T(n):Pt(n)?this.k(n):this.g(n)}O(n,t=this._$AB){return this._$AA.parentNode.insertBefore(n,t)}T(n){this._$AH!==n&&(this._$AR(),this._$AH=this.O(n))}g(n){this._$AH!==N&&tt(this._$AH)?this._$AA.nextSibling.data=n:this.T(q.createTextNode(n)),this._$AH=n}$(n){var t;const{values:e,_$litType$:s}=n,i=typeof s=="number"?this._$AC(n):(s.el===void 0&&(s.el=et.createElement(s.h,this.options)),s);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===i)this._$AH.p(e);else{const l=new jt(i,this),d=l.v(this.options);l.p(e),this.T(d),this._$AH=l}}_$AC(n){let t=_t.get(n.strings);return t===void 0&&_t.set(n.strings,t=new et(n)),t}k(n){Rt(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let e,s=0;for(const i of n)s===t.length?t.push(e=new W(this.O(V()),this.O(V()),this,this.options)):e=t[s],e._$AI(i),s++;s<t.length&&(this._$AR(e&&e._$AB.nextSibling,s),t.length=s)}_$AR(n=this._$AA.nextSibling,t){var e;for((e=this._$AP)===null||e===void 0||e.call(this,!1,!0,t);n&&n!==this._$AB;){const s=n.nextSibling;n.remove(),n=s}}setConnected(n){var t;this._$AM===void 0&&(this._$Cm=n,(t=this._$AP)===null||t===void 0||t.call(this,n))}}class nt{constructor(n,t,e,s,i){this.type=1,this._$AH=N,this._$AN=void 0,this.element=n,this.name=t,this._$AM=s,this.options=i,e.length>2||e[0]!==""||e[1]!==""?(this._$AH=Array(e.length-1).fill(new String),this.strings=e):this._$AH=N}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(n,t=this,e,s){const i=this.strings;let l=!1;if(i===void 0)n=H(this,n,t,0),l=!tt(n)||n!==this._$AH&&n!==F,l&&(this._$AH=n);else{const d=n;let u,c;for(n=i[0],u=0;u<i.length-1;u++)c=H(this,d[e+u],t,u),c===F&&(c=this._$AH[u]),l||(l=!tt(c)||c!==this._$AH[u]),c===N?n=N:n!==N&&(n+=(c!=null?c:"")+i[u+1]),this._$AH[u]=c}l&&!s&&this.j(n)}j(n){n===N?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,n!=null?n:"")}}class qt extends nt{constructor(){super(...arguments),this.type=3}j(n){this.element[this.name]=n===N?void 0:n}}const de=j?j.emptyScript:"";class Ft extends nt{constructor(){super(...arguments),this.type=4}j(n){n&&n!==N?this.element.setAttribute(this.name,de):this.element.removeAttribute(this.name)}}class Gt extends nt{constructor(n,t,e,s,i){super(n,t,e,s,i),this.type=5}_$AI(n,t=this){var e;if((n=(e=H(this,n,t,0))!==null&&e!==void 0?e:N)===F)return;const s=this._$AH,i=n===N&&s!==N||n.capture!==s.capture||n.once!==s.once||n.passive!==s.passive,l=n!==N&&(s===N||i);i&&this.element.removeEventListener(this.name,this,s),l&&this.element.addEventListener(this.name,this,n),this._$AH=n}handleEvent(n){var t,e;typeof this._$AH=="function"?this._$AH.call((e=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&e!==void 0?e:this.element,n):this._$AH.handleEvent(n)}}class Wt{constructor(n,t,e){this.element=n,this.type=6,this._$AN=void 0,this._$AM=t,this.options=e}get _$AU(){return this._$AM._$AU}_$AI(n){H(this,n)}}const fe={P:"$lit$",A:U,M:vt,C:1,L:Ot,R:jt,D:Pt,V:H,I:W,H:nt,N:Ft,U:Gt,B:qt,F:Wt},Nt=ot.litHtmlPolyfillSupport;Nt==null||Nt(et,W),((ct=ot.litHtmlVersions)!==null&&ct!==void 0?ct:ot.litHtmlVersions=[]).push("2.4.0");const he=(o,n,t)=>{var e,s;const i=(e=t==null?void 0:t.renderBefore)!==null&&e!==void 0?e:n;let l=i._$litPart$;if(l===void 0){const d=(s=t==null?void 0:t.renderBefore)!==null&&s!==void 0?s:null;i._$litPart$=l=new W(n.insertBefore(V(),d),d,void 0,t!=null?t:{})}return l._$AI(o),l},pe={name:"adder",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],outputs:[{name:"sum",type:"number"}],onUpdate(o){return`
      <div>hello world</div>
      <div>the answer is ${o.outputs[0]}</div>
    `},func:(o,n)=>[o+n]},me={name:"async_adder",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],outputs:[{name:"sum",type:"number"}],onUpdate(o){return`
      <div>hello world</div>
      <div>the answer is ${o.outputs[0]}</div>
    `},func:async(o,n)=>{const t=new Promise(e=>{setTimeout(()=>{e(o+n)},1e3)});return await Promise.all([t])}};function ge(){self.onmessage=function(o){const n=o.data,t=n.buf,e=n.w,s=n.h;var i=new Float32Array(e*s);function l(y,v,$,w){return($-w)*($-w)+y[w][v]*y[w][v]}function d(y,v,$,w){return(y[$][v]*y[$][v]-y[w][v]*y[w][v]+$*$-w*w)/(2*($-w))}for(var u=[],c=0;c<s;++c)u[c]=new Uint32Array(e);for(var c=0;c<s;++c)new Uint32Array(e);for(var c=0;c<s;++c)new Uint32Array(e);for(var p=new Uint32Array(s),f=new Uint32Array(s),h,c=0;c<s;++c){for(var m=-e,g=0;g<e;++g)t[(s-1-c)*e*4+g*4+0]!=0?(u[c][g]=0,m=g):u[c][g]=g-m;m=2*e;for(var g=e-1;g>=0;--g)t[(s-1-c)*e*4+g*4+0]!=0?m=g:(h=m-g,h<u[c][g]&&(u[c][g]=h))}for(var g=0;g<e;++g){var r=0;p[0]=0,f[0]=0;for(var c=1;c<s;++c){for(;r>=0&&l(u,g,p[r],f[r])>l(u,g,p[r],c);)r-=1;if(r<0)r=0,f[0]=c;else{var a=1+d(u,g,f[r],c);a<s&&(r+=1,f[r]=c,p[r]=a)}}for(var c=s-1;c>=0;--c)h=Math.sqrt(l(u,g,c,f[r])),i[(s-1-c)*e+g]=h,c==p[r]&&(r-=1)}self.postMessage([i,n.w,n.h]),self.close()}}const ve={name:"img distance",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"distances",type:"img_float32"}],func:async o=>{const n=new Blob(["("+ge.toString()+"())"]),t=window.URL.createObjectURL(n),e=new Worker(t),s=new Promise(u=>{e.onmessage=c=>{const p=c.data,f={data:p[0],width:p[1],height:p[2]};u(f)}}),i=o.data,l=o.width,d=o.height;return e.postMessage({buf:i,w:l,h:d}),await Promise.all([s])}};function ye(){function o(n){var t=n.height,e=n.width,s=n.data,i=new Uint8ClampedArray(t*e*4),l,d,u,c,p,f,h,m,g,r,a;for(r=1;r<t-1;++r)for(a=1;a<e-1;++a)l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],u=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],p=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],g=s[(t-2-r)*e*4+(a+1)*4+0]+s[(t-2-r)*e*4+(a+1)*4+1]+s[(t-2-r)*e*4+(a+1)*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],c=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],f=s[(t-r)*e*4+(a-1)*4+0]+s[(t-r)*e*4+(a-1)*4+1]+s[(t-r)*e*4+(a-1)*4+2],h=s[(t-r)*e*4+(a+1)*4+0]+s[(t-r)*e*4+(a+1)*4+1]+s[(t-r)*e*4+(a+1)*4+2],m=s[(t-2-r)*e*4+(a-1)*4+0]+s[(t-2-r)*e*4+(a-1)*4+1]+s[(t-2-r)*e*4+(a-1)*4+2],l!=u||l!=p||l!=g||l!=d||l!=c||l!=f||l!=h||l!=m?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);for(r=1;r<t-1;++r)a=e-1,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],f=s[(t-r)*e*4+(a-1)*4+0]+s[(t-r)*e*4+(a-1)*4+1]+s[(t-r)*e*4+(a-1)*4+2],m=s[(t-2-r)*e*4+(a-1)*4+0]+s[(t-2-r)*e*4+(a-1)*4+1]+s[(t-2-r)*e*4+(a-1)*4+2],c=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],p=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],l!=d||l!=p||l!=m||l!=c||l!=f?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),a=0,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],u=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],h=s[(t-r)*e*4+(a+1)*4+0]+s[(t-r)*e*4+(a+1)*4+1]+s[(t-r)*e*4+(a+1)*4+2],g=s[(t-2-r)*e*4+(a+1)*4+0]+s[(t-2-r)*e*4+(a+1)*4+1]+s[(t-2-r)*e*4+(a+1)*4+2],c=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],p=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],l!=u||l!=p||l!=g||l!=c||l!=h?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);for(a=1;a<e-1;++a)r=t-1,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],u=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],f=s[(t-r)*e*4+(a-1)*4+0]+s[(t-r)*e*4+(a-1)*4+1]+s[(t-r)*e*4+(a-1)*4+2],c=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],h=s[(t-r)*e*4+(a+1)*4+0]+s[(t-r)*e*4+(a+1)*4+1]+s[(t-r)*e*4+(a+1)*4+2],l!=d||l!=u||l!=f||l!=c||l!=h?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=0,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],u=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],m=s[(t-2-r)*e*4+(a-1)*4+0]+s[(t-2-r)*e*4+(a-1)*4+1]+s[(t-2-r)*e*4+(a-1)*4+2],p=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],g=s[(t-2-r)*e*4+(a+1)*4+0]+s[(t-2-r)*e*4+(a+1)*4+1]+s[(t-2-r)*e*4+(a+1)*4+2],l!=d||l!=u||l!=m||l!=p||l!=g?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);return r=0,a=0,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],u=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],p=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],g=s[(t-2-r)*e*4+(a+1)*4+0]+s[(t-2-r)*e*4+(a+1)*4+1]+s[(t-2-r)*e*4+(a+1)*4+2],l!=u||l!=p||l!=g?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=0,a=e-1,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],p=s[(t-2-r)*e*4+a*4+0]+s[(t-2-r)*e*4+a*4+1]+s[(t-2-r)*e*4+a*4+2],m=s[(t-2-r)*e*4+(a-1)*4+0]+s[(t-2-r)*e*4+(a-1)*4+1]+s[(t-2-r)*e*4+(a-1)*4+2],l!=d||l!=p||l!=m?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=t-1,a=0,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],u=s[(t-1-r)*e*4+(a+1)*4+0]+s[(t-1-r)*e*4+(a+1)*4+1]+s[(t-1-r)*e*4+(a+1)*4+2],c=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],h=s[(t-r)*e*4+(a+1)*4+0]+s[(t-r)*e*4+(a+1)*4+1]+s[(t-r)*e*4+(a+1)*4+2],l!=u||l!=c||l!=h?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=t-1,a=e-1,l=s[(t-1-r)*e*4+a*4+0]+s[(t-1-r)*e*4+a*4+1]+s[(t-1-r)*e*4+a*4+2],d=s[(t-1-r)*e*4+(a-1)*4+0]+s[(t-1-r)*e*4+(a-1)*4+1]+s[(t-1-r)*e*4+(a-1)*4+2],c=s[(t-r)*e*4+a*4+0]+s[(t-r)*e*4+a*4+1]+s[(t-r)*e*4+a*4+2],f=s[(t-r)*e*4+(a-1)*4+0]+s[(t-r)*e*4+(a-1)*4+1]+s[(t-r)*e*4+(a-1)*4+2],l!=d||l!=c||l!=f?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),new ImageData(i,e,t)}self.onmessage=function(n){const t=n.data;buf=o(t.img),self.postMessage([buf]),self.close()}}const $e={name:"img edge detect",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async o=>{const n=new Blob(["("+ye.toString()+"())"]),t=window.URL.createObjectURL(n),e=new Worker(t),s=new Promise(i=>{e.onmessage=l=>{i(l.data[0])}});return e.postMessage({img:o}),await Promise.all([s])}};function we(){function o(n,t){for(var e=n.data,s=n.width,i=n.height,l=new Uint8ClampedArray(4*i*s),d=0;d<i;++d)for(var u=0;u<s;++u)e[(i-1-d)*s+u]<=t?(l[(i-1-d)*s*4+u*4+0]=255,l[(i-1-d)*s*4+u*4+1]=255,l[(i-1-d)*s*4+u*4+2]=255,l[(i-1-d)*s*4+u*4+3]=255):(l[(i-1-d)*s*4+u*4+0]=0,l[(i-1-d)*s*4+u*4+1]=0,l[(i-1-d)*s*4+u*4+2]=0,l[(i-1-d)*s*4+u*4+3]=255);return new ImageData(l,s,i)}self.onmessage=function(n){const t=n.data;buf=o(t.img,t.offset),self.postMessage([buf]),self.close()}}const Ae={name:"img offset",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"offset",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(o,n)=>{const t=new Blob(["("+we.toString()+"())"]),e=window.URL.createObjectURL(t),s=new Worker(e),i=new Promise(l=>{s.onmessage=d=>{l(d.data[0])}});return s.postMessage({img:o,offset:n}),await Promise.all([i])}},be={name:"read png",inputs:[{name:"imageRGBA",type:"img_uint8",input:"upload"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],func:o=>[o]};var kt=100;function xe(o,n){const t=document.createElement("canvas");t.width=n,t.height=o;const e=t.getContext("2d");e.beginPath(),e.rect(0,0,n,o),e.fillStyle="black",e.fill();var s=40,i=e.createLinearGradient(0,0,s,0);i.addColorStop(0,"black"),i.addColorStop(.5,"red"),i.addColorStop(1,"green"),e.fillStyle=i,e.fillRect(0,0,s,s);const l=10;return e.beginPath(),e.strokeStyle="#AAAAAA",e.arc(o/2,n/2,n/2-l,0,2*Math.PI),e.stroke(),e.getImageData(0,0,n,o)}const _e={name:"img sample",inputs:[{name:"height",type:"number",input:"box"},{name:"width",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(o,n)=>{o==0&&(o=kt),n==0&&(n=kt);var t=xe(o,n);return[t]}};function Ne(){self.onmessage=function(o){const n=o.data,t=n.buf,e=n.w,s=n.h,i=n.threshold;let l,d,u,c,p;for(var f=0;f<s;++f)for(var h=0;h<e;++h){l=t[(s-1-f)*e*4+h*4+0],d=t[(s-1-f)*e*4+h*4+1],u=t[(s-1-f)*e*4+h*4+2],c=t[(s-1-f)*e*4+h*4+3],p=(l+d+u)/(3*255);let m;c===0||p>=i?m=255:m=0,t[(s-1-f)*e*4+h*4+0]=m,t[(s-1-f)*e*4+h*4+1]=m,t[(s-1-f)*e*4+h*4+2]=m,t[(s-1-f)*e*4+h*4+3]=255}self.postMessage([t,e,s]),self.close()}}const ke={name:"thresholdRGBA",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"threshold",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(o,n)=>{const t=new Blob(["("+Ne.toString()+"())"]),e=window.URL.createObjectURL(t),s=new Worker(e),i=new Promise(c=>{s.onmessage=p=>{const f=p.data,h={data:f[0],width:f[1],height:f[2]};c(h)}}),l=o.data,d=o.width,u=o.height;return s.postMessage({buf:l,w:d,h:u,threshold:n}),await Promise.all([i])}};function Te(){function o(n,t=1,e=!0){var s=n.height,i=n.width,l=n.data,d=0,u=128,c=64,p=1,f=128,h=64,m=[];function g(b,x){if(l[(s-1-b)*i*4+x*4+d]!=0||l[(s-1-b)*i*4+x*4+p]!=0)for(m[m.length]=[[x,b]];;)if(l[(s-1-b)*i*4+x*4+d]&u)l[(s-1-b)*i*4+x*4+d]=l[(s-1-b)*i*4+x*4+d]&~u,b+=1,m[m.length-1][m[m.length-1].length]=[x,b];else if(l[(s-1-b)*i*4+x*4+d]&c)l[(s-1-b)*i*4+x*4+d]=l[(s-1-b)*i*4+x*4+d]&~c,b-=1,m[m.length-1][m[m.length-1].length]=[x,b];else if(l[(s-1-b)*i*4+x*4+p]&f)l[(s-1-b)*i*4+x*4+p]=l[(s-1-b)*i*4+x*4+p]&~f,x+=1,m[m.length-1][m[m.length-1].length]=[x,b];else if(l[(s-1-b)*i*4+x*4+p]&h)l[(s-1-b)*i*4+x*4+p]=l[(s-1-b)*i*4+x*4+p]&~h,x-=1,m[m.length-1][m[m.length-1].length]=[x,b];else break}for(var r=1;r<s-1;++r)a=0,g(r,a),a=i-1,g(r,a);for(var a=1;a<i-1;++a)r=0,g(r,a),r=s-1,g(r,a);for(var r=1;r<s-1;++r)for(var a=1;a<i-1;++a)g(r,a);for(var y=t,v=[],$=0;$<m.length;++$){var w=m[$][0][0],A=m[$][0][1];v[v.length]=[[w,A]];for(var E=w,I=A,M=1,R=1;R<m[$].length;++R){var z=C,rt=S,C=m[$][R][0],S=m[$][R][1];if(M==1)E+=C,I+=S,M+=1;else{var ie=E/M,re=I/M,at=ie-w,lt=re-A,L=Math.sqrt(at*at+lt*lt),ae=lt/L,le=-at/L,ce=Math.abs(ae*(C-w)+le*(S-A));ce<y?(E+=C,I+=S,M+=1):(v[v.length-1][v[v.length-1].length]=[z,rt],w=z,A=rt,E=z,I=rt,M=1)}R==m[$].length-1&&(v[v.length-1][v[v.length-1].length]=[C,S])}}if(v.length>1&&e==!0){for(var Y=i*i+s*s,B=null,$=0;$<v.length;++$){var C=v[$][0][0],S=v[$][0][0],L=C*C+S*S;L<Y&&(Y=L,B=$)}if(B!=null){var k=[v[B]];v.splice(B,1)}for(;v.length>0;){var Y=i*i+s*s,w=k[k.length-1][k[k.length-1].length-1][0],A=k[k.length-1][k[k.length-1].length-1][1];B=null;for(var $=0;$<v.length;++$){var C=v[$][0][0],S=v[$][0][1],L=(C-w)*(C-w)+(S-A)*(S-A);L<Y&&(Y=L,B=$)}B!=null&&(k[k.length]=v[B],v.splice(B,1))}}else v.length>1&&e==!1||v.length==1?k=v:k=[];return console.log("rez",k),k}self.onmessage=function(n){const t=n.data;console.log("workerInternal.onmessage",t),buf=o(t.img,t.vectorFit,t.sort),self.postMessage([buf]),self.close()}}const Ee={name:"img vectorize",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"vectorFit",type:"number",input:"box"},{name:"sort",type:"boolean",input:"check"}],outputs:[{name:"paths",type:"path"}],onUpdate(o,n){const t=o.outputs[0];return document.querySelector(`[data-id="${n}"] > .node-view`),`
      <div><span>paths</span> <span>${t.length}</span></div>
    `},func:async(o,n,t)=>{console.log("Vectorize Sort",t);const e=new Blob(["("+Te.toString()+"())"]),s=window.URL.createObjectURL(e),i=new Worker(s);console.log("after new Worker");const l=new Promise(d=>{i.onmessage=u=>{console.log("receive worker.onmessage",u.data[0]),d(u.data[0])}});return console.log("work,postMessage"),n==0&&(n=1),i.postMessage({img:o,vectorFit:n,sort:t}),await Promise.all([l])}},Ce={name:"img viewer",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(o){const n=o.inputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:o=>[o]},Se={name:"number",inputs:[{name:"inputNum",type:"number",input:"box"}],outputs:[{name:"outputNum",type:"number"}],onUpdate(o){return`value: ${o.inputs[0]}`},func(o){return[o]}},Me={name:"path viewer",inputs:[{name:"paths",type:"paths"}],outputs:[],onUpdate(o){const n=(i,l,d)=>{const u=(p,f,h)=>h===0?[...p,[[0,0],f[0],f[f.length-1]]]:[...p,[p[h-1][2],f[0],f[f.length-1]]];return i.reduce(u,[]).map(p=>p.slice(0,2)).map(p=>t(p,l,d,"red"))},t=(i,l,d,u="black")=>`<path d="${`M ${i.map(p=>`${p[0]} ${d-p[1]}`).join(",")}`}" fill="none" stroke="${u}"></path>`,e=(i,l,d)=>{const u=i.map(p=>t(p,l,d)),c=n(i,l,d);return[...u,...c]};return o.inputs[0]?`<svg viewBox="0 0 500 500">${e(o.inputs[0],100,100)}</svg>`:void 0},func:(o,n)=>[o+n]};function Be(){self.onmessage=function(o){const n=o.data;self.postMessage(n[0]+n[1]+100),self.close()}}const Ue={name:"web worker example",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],outputs:[{name:"sum",type:"number"}],onUpdate(o){},func:async(o,n)=>{const t=new Blob(["("+Be.toString()+"())"]),e=window.URL.createObjectURL(t),s=new Worker(e),i=new Promise(l=>{s.onmessage=d=>{const u=d.data;l(u)}});return s.postMessage([o,n]),await Promise.all([i])}};class Ie extends Map{set(n,t){return super.set(n,t),t}}class zt extends WeakMap{set(n,t){return super.set(n,t),t}}/*! (c) Andrea Giammarchi - ISC */const Le=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Re=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,Pe=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,De=/[\x01\x02]/g,He=(o,n,t)=>{let e=0;return o.join("").trim().replace(Re,(s,i,l,d)=>{let u=i+l.replace(Pe,"=$2$1").trimEnd();return d.length&&(u+=t||Le.test(i)?" /":"></"+i),"<"+u+">"}).replace(De,s=>s===""?"<!--"+n+e+++"-->":n+e++)},Oe=1,Yt=111,je=({firstChild:o,lastChild:n})=>{const t=document.createRange();return t.setStartAfter(o),t.setEndAfter(n),t.deleteContents(),o},qe=(o,n)=>o.nodeType===Yt?1/n<0?n?je(o):o.lastChild:n?o.valueOf():o.firstChild:o,Fe=o=>{const{firstChild:n,lastChild:t}=o;if(n===t)return t||o;const{childNodes:e}=o,s=[...e];return{ELEMENT_NODE:Oe,nodeType:Yt,firstChild:n,lastChild:t,valueOf(){return e.length!==s.length&&o.append(...s),o}}},{isArray:Ge}=Array,We=o=>n=>{for(const t in n){const e=t==="role"?t:`aria-${t}`,s=n[t];s==null?o.removeAttribute(e):o.setAttribute(e,s)}},yt=o=>o==null?o:o.valueOf(),ze=(o,n)=>{let t,e=!0;const s=document.createAttributeNS(null,n);return i=>{const l=yt(i);t!==l&&((t=l)==null?e||(o.removeAttributeNode(s),e=!0):(s.value=l,e&&(o.setAttributeNodeNS(s),e=!1)))}},Ye=(o,n,t)=>e=>{const s=!!yt(e);t!==s&&((t=s)?o.setAttribute(n,""):o.removeAttribute(n))},Ke=({dataset:o})=>n=>{for(const t in n){const e=n[t];e==null?delete o[t]:o[t]=e}},Tt=(o,n)=>{let t,e,s=n.slice(2);return!(n in o)&&(e=n.toLowerCase())in o&&(s=e.slice(2)),i=>{const l=Ge(i)?i:[i,!1];t!==l[0]&&(t&&o.removeEventListener(s,t,l[1]),(t=l[0])&&o.addEventListener(s,t,l[1]))}},Xe=o=>{let n;return t=>{n!==t&&(n=t,typeof t=="function"?t(o):t.current=o)}},Ze=(o,n)=>n==="dataset"?Ke(o):t=>{o[n]=t},Je=o=>{let n;return t=>{const e=yt(t);n!=e&&(n=e,o.textContent=e==null?"":e)}},Qe=(o,n,t,e,s)=>{const i=t.length;let l=n.length,d=i,u=0,c=0,p=null;for(;u<l||c<d;)if(l===u){const f=d<i?c?e(t[c-1],-0).nextSibling:e(t[d-c],0):s;for(;c<d;)o.insertBefore(e(t[c++],1),f)}else if(d===c)for(;u<l;)(!p||!p.has(n[u]))&&o.removeChild(e(n[u],-1)),u++;else if(n[u]===t[c])u++,c++;else if(n[l-1]===t[d-1])l--,d--;else if(n[u]===t[d-1]&&t[c]===n[l-1]){const f=e(n[--l],-1).nextSibling;o.insertBefore(e(t[c++],1),e(n[u++],-1).nextSibling),o.insertBefore(e(t[--d],1),f),n[l]=t[d]}else{if(!p){p=new Map;let f=c;for(;f<d;)p.set(t[f],f++)}if(p.has(n[u])){const f=p.get(n[u]);if(c<f&&f<d){let h=u,m=1;for(;++h<l&&h<d&&p.get(n[h])===f+m;)m++;if(m>f-c){const g=e(n[u],0);for(;c<f;)o.insertBefore(e(t[c++],1),g)}else o.replaceChild(e(t[c++],1),e(n[u++],-1))}else u++}else o.removeChild(e(n[u++],-1))}return t},{isArray:Kt,prototype:Ve}=Array,{indexOf:tn}=Ve,{createDocumentFragment:en,createElement:nn,createElementNS:sn,createTextNode:on,createTreeWalker:rn,importNode:an}=new Proxy(document,{get:(o,n)=>o[n].bind(o)}),ln=o=>{const n=nn("template");return n.innerHTML=o,n.content};let st;const cn=o=>{st||(st=sn("http://www.w3.org/2000/svg","svg")),st.innerHTML=o;const n=en();return n.append(...st.childNodes),n},un=(o,n)=>n?cn(o):ln(o),dn=({childNodes:o},n)=>o[n],X=(o,n,t)=>Qe(o.parentNode,n,t,qe,o),fn=o=>{let n,t,e=[];const s=i=>{switch(typeof i){case"string":case"number":case"boolean":n!==i&&(n=i,t||(t=on("")),t.data=i,e=X(o,e,[t]));break;case"object":case"undefined":if(i==null){n!=i&&(n=i,e=X(o,e,[]));break}if(Kt(i)){n=i,i.length===0?e=X(o,e,[]):typeof i[0]=="object"?e=X(o,e,i):s(String(i));break}if(n!==i)if("ELEMENT_NODE"in i)n=i,e=X(o,e,i.nodeType===11?[...i.childNodes]:[i]);else{const l=i.valueOf();l!==i&&s(l)}break;case"function":s(i(o));break}};return s},hn=(o,n)=>{switch(n[0]){case"?":return Ye(o,n.slice(1),!1);case".":return Ze(o,n.slice(1));case"@":return Tt(o,"on"+n.slice(1));case"o":if(n[1]==="n")return Tt(o,n)}switch(n){case"ref":return Xe(o);case"aria":return We(o)}return ze(o,n)};function pn(o){const{type:n,path:t}=o,e=t.reduceRight(dn,this);return n==="node"?fn(e):n==="attr"?hn(e,o.name):Je(e)}const ut=o=>{const n=[];let{parentNode:t}=o;for(;t;)n.push(tn.call(t.childNodes,o)),o=t,{parentNode:t}=o;return n},Z="is\xB5",Et=new zt,mn=/^(?:textarea|script|style|title|plaintext|xmp)$/,it=()=>({stack:[],entry:null,wire:null}),gn=(o,n)=>{const{content:t,updates:e}=yn(o,n);return{type:o,template:n,content:t,updates:e,wire:null}},vn=(o,n)=>{const t=o==="svg",e=He(n,Z,t),s=un(e,t),i=rn(s,129),l=[],d=n.length-1;let u=0,c=`${Z}${u}`;for(;u<d;){const p=i.nextNode();if(!p)throw`bad template: ${e}`;if(p.nodeType===8)p.data===c&&(l.push({type:"node",path:ut(p)}),c=`${Z}${++u}`);else{for(;p.hasAttribute(c);)l.push({type:"attr",path:ut(p),name:p.getAttribute(c)}),p.removeAttribute(c),c=`${Z}${++u}`;mn.test(p.localName)&&p.textContent.trim()===`<!--${c}-->`&&(p.textContent="",l.push({type:"text",path:ut(p)}),c=`${Z}${++u}`)}}return{content:s,nodes:l}},yn=(o,n)=>{const{content:t,nodes:e}=Et.get(n)||Et.set(n,vn(o,n)),s=an(t,!0),i=e.map(pn,s);return{content:s,updates:i}},ht=(o,{type:n,template:t,values:e})=>{const s=Xt(o,e);let{entry:i}=o;(!i||i.template!==t||i.type!==n)&&(o.entry=i=gn(n,t));const{content:l,updates:d,wire:u}=i;for(let c=0;c<s;c++)d[c](e[c]);return u||(i.wire=Fe(l))},Xt=({stack:o},n)=>{const{length:t}=n;for(let e=0;e<t;e++){const s=n[e];s instanceof pt?n[e]=ht(o[e]||(o[e]=it()),s):Kt(s)?Xt(o[e]||(o[e]=it()),s):o[e]=null}return t<o.length&&o.splice(t),t};class pt{constructor(n,t,e){this.type=n,this.template=t,this.values=e}}const Zt=o=>{const n=new zt,t=e=>(s,...i)=>ht(e,{type:o,template:s,values:i});return Object.assign((e,...s)=>new pt(o,e,s),{for(e,s){const i=n.get(e)||n.set(e,new Ie);return i.get(s)||i.set(s,t(it()))},node:(e,...s)=>ht(it(),new pt(o,e,s)).valueOf()})},Jt=Zt("html");Zt("svg");const $n={name:"web serial",inputs:[],outputs:[],onUpdate(o){return Jt.node`
      <button @click=${wn}>ports</button>
    `},func:(o,n)=>[o+n]};async function wn(){const o=await navigator.serial.getPorts();console.log("ports",o)}const An={name:"web socket",inputs:[{name:"msg",type:"string",input:"box"}],outputs:[],onUpdate(o){return Jt.node`
      <button @click=${()=>bn(o.state)}>start socket</button>
    `},func:o=>(console.log(o),[])};function bn(o){var n=new WebSocket("ws://localhost:3000");n.onopen=()=>{n.send("r"),o.count++},n.onclose=function(){console.log("web socket closed")}}const G={adder:pe,async_adder:me,img_distance:ve,img_edge_detect:$e,img_offset:Ae,img_read_png:be,img_sample:_e,img_threshold:ke,img_vectorize:Ee,img_viewer:Ce,number:Se,path_viewer:Me,worker_example:Ue,webSerial:$n,webSocket:An},_={nodeTypes:G,nodes:{fds:{type:"number",x:150,y:0,inputs:[0],outputs:[42],evaluated:[!1]},fsa:{type:"number",x:30,y:0,inputs:[0],outputs:[43],evaluated:[!1]},dsf:{type:"adder",x:100,y:100,inputs:[0,0],outputs:[42],evaluated:[!1]}},connections:[["fsa:out:0","dsf:in:0"],["fsa:out:0","fds:in:0"],["fds:out:0","dsf:in:1"]],selectedNodes:[],tempEdge:["",[0,0]],dataflow:null,name:"default-name"};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const xn={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},_n=o=>(...n)=>({_$litDirective$:o,values:n});class Nn{constructor(n){}get _$AU(){return this._$AM._$AU}_$AT(n,t,e){this._$Ct=n,this._$AM=t,this._$Ci=e}_$AS(n,t){return this.update(n,t)}update(n,t){return this.render(...t)}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{I:kn}=fe,Ct=()=>document.createComment(""),J=(o,n,t)=>{var e;const s=o._$AA.parentNode,i=n===void 0?o._$AB:n._$AA;if(t===void 0){const l=s.insertBefore(Ct(),i),d=s.insertBefore(Ct(),i);t=new kn(l,d,o,o.options)}else{const l=t._$AB.nextSibling,d=t._$AM,u=d!==o;if(u){let c;(e=t._$AQ)===null||e===void 0||e.call(t,o),t._$AM=o,t._$AP!==void 0&&(c=o._$AU)!==d._$AU&&t._$AP(c)}if(l!==i||u){let c=t._$AA;for(;c!==l;){const p=c.nextSibling;s.insertBefore(c,i),c=p}}}return t},D=(o,n,t=o)=>(o._$AI(n,t),o),Tn={},En=(o,n=Tn)=>o._$AH=n,Cn=o=>o._$AH,dt=o=>{var n;(n=o._$AP)===null||n===void 0||n.call(o,!1,!0);let t=o._$AA;const e=o._$AB.nextSibling;for(;t!==e;){const s=t.nextSibling;t.remove(),t=s}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const St=(o,n,t)=>{const e=new Map;for(let s=n;s<=t;s++)e.set(o[s],s);return e},Sn=_n(class extends Nn{constructor(o){if(super(o),o.type!==xn.CHILD)throw Error("repeat() can only be used in text expressions")}ht(o,n,t){let e;t===void 0?t=n:n!==void 0&&(e=n);const s=[],i=[];let l=0;for(const d of o)s[l]=e?e(d,l):l,i[l]=t(d,l),l++;return{values:i,keys:s}}render(o,n,t){return this.ht(o,n,t).values}update(o,[n,t,e]){var s;const i=Cn(o),{values:l,keys:d}=this.ht(n,t,e);if(!Array.isArray(i))return this.ut=d,l;const u=(s=this.ut)!==null&&s!==void 0?s:this.ut=[],c=[];let p,f,h=0,m=i.length-1,g=0,r=l.length-1;for(;h<=m&&g<=r;)if(i[h]===null)h++;else if(i[m]===null)m--;else if(u[h]===d[g])c[g]=D(i[h],l[g]),h++,g++;else if(u[m]===d[r])c[r]=D(i[m],l[r]),m--,r--;else if(u[h]===d[r])c[r]=D(i[h],l[r]),J(o,c[r+1],i[h]),h++,r--;else if(u[m]===d[g])c[g]=D(i[m],l[g]),J(o,i[h],i[m]),m--,g++;else if(p===void 0&&(p=St(d,g,r),f=St(u,h,m)),p.has(u[h]))if(p.has(u[m])){const a=f.get(d[g]),y=a!==void 0?i[a]:null;if(y===null){const v=J(o,i[h]);D(v,l[g]),c[g]=v}else c[g]=D(y,l[g]),J(o,i[h],y),i[a]=null;g++}else dt(i[m]),m--;else dt(i[h]),h++;for(;g<=r;){const a=J(o,c[r+1]);D(a,l[g]),c[g++]=a}for(;h<=m;){const a=i[h++];a!==null&&dt(a)}return this.ut=d,En(o,c),F}});function Mn(o,n,t,e,s,i){const l=o.target.files;d(l);function d(p,f=[]){let h=p[0],m=h.name.split(".");if(m[0],m[m.length-1],f.length>0&&f.includes(enxtension))throw"Extension not recongized: "+m;u(h)}function u(p){if(G[n.type].inputs[i].type==="img_uint8"){const m=new FileReader;m.readAsDataURL(p),m.onloadend=c}}function c(p){var f=new Image;f.setAttribute("src",p.target.result),f.onload=function(){const h=document.createElement("canvas");if(h.height=f.height,h.width=f.width,f.width>f.height)var m=0,g=h.height*.5*(1-f.height/f.width),r=h.width,a=h.width*f.height/f.width;else var m=h.width*.5*(1-f.width/f.height),g=0,r=h.height*f.width/f.height,a=h.height;var y=h.getContext("2d");y.clearRect(0,0,h.width,h.height),y.drawImage(f,m,g,r,a);var y=h.getContext("2d");y.canvas.width=f.width,y.canvas.height=f.height,y.drawImage(f,0,0);const v=y.getImageData(0,0,y.canvas.width,y.canvas.height);n.inputs[i]={data:v.data,width:v.width,height:v.height}}}}function Bn(o){_.connections=_.connections.filter(([n,t])=>!n.includes(o)&&!t.includes(o)),delete _.nodes[o],_.selectedNodes=_.selectedNodes.filter(n=>n!==o)}async function Un(o,n,t,e){function s(){const f=Object.keys(n),h={};return f.forEach(m=>h[m]=-1),l(h)(o,0),h}function i(f,h,m){return m.indexOf(f)===h}const l=f=>(h,m)=>{f[h]=m++,t.filter(([r,a])=>a.includes(h)).map(r=>r[0].split(":")[0]).filter(i).forEach(r=>l(f)(r,m))},d=f=>{let h=[];for(const m in f){const g=f[m];if(!(g<0)){for(;h.length<=g;)h.push([]);h[g].push(m)}}return h=h.reverse(),h},u=async f=>{const h=n[f],m=h.type,g=e[m],r=g.func,a=h.inputs.map((w,A)=>`${f}:in:${A}`),y={};t.forEach(w=>{y[w[1]]=w[0]}),a.forEach(w=>{if(w in y){const A=w.split(":")[2],E=y[w],[I,M,R]=E.split(":"),z=n[I].outputs[R];h.inputs[A]=z}});const v=g.inputs.map(w=>w.type);h.inputs.forEach((w,A)=>{v[A]==="number"&&(h.inputs[A]=Number(w))});const $=await r(...h.inputs);return h.outputs=$,$},c=s(),p=d(c);for(let f of p){const h=f.map(u);await Promise.all(h),f.forEach(m=>{const g=n[m],r=g.type,a=e[r];if(a.func,!a.onUpdate)return;const y=a.onUpdate(g),v=document.querySelector(`[data-id="${m}"] > .node-view`);if(typeof y=="string")v.innerHTML=y;else{for(;v.firstChild;)v.removeChild(v.lastChild);v.append(y)}})}}function Qt(o){Un(o,_.nodes,_.connections,_.nodeTypes).then(()=>{})}const mt={number:0,string:"",img_uint8:In(),img_float32:{data:new Float32Array(1),width:1,height:1},boolean:!0,path:[]};function In(){const t=new Uint8ClampedArray(4e4);for(let e=0;e<100;e++)for(let s=0;s<100;s++)t[(e*100+s)*4]=e*255/100,t[(e*100+s)*4+1]=s*255/100,t[(e*100+s)*4+2]=0,t[(e*100+s)*4+3]=255;return{data:t,width:100,height:100}}function Mt(o,n){const t={img_uint8:e=>({data:btoa(e.data.reduce((s,i)=>s+String.fromCharCode(i),"")),width:e.width,height:e.height})};return o in t?t[o](n):n}function Bt(o,n){const t={img_uint8:e=>({data:Ln(e.data),width:e.width,height:e.height})};return o in t?t[o](n):n}const Ln=o=>{const n=atob(o),t=n.length,e=new Uint8ClampedArray(t);for(let s=0;s<t;s++){const l=n[s].charCodeAt(0);e[s]=l}return e};function Rn({nodes:o,connections:n,name:t}){const e={nodes:{},connections:n,name:t};for(const s in o){const i={},l=o[s];i.x=l.x,i.y=l.y,i.type=l.type,i.inputs=[],i.outputs=[],i.evaluated=[];const d=l.type,u=G[d].inputs.map(p=>p.type),c=G[d].outputs.map(p=>p.type);u.forEach((p,f)=>{const h=l.inputs[f];i.inputs[f]=Mt(p,h)}),c.forEach((p,f)=>{const h=mt[p];i.outputs[f]=Mt(p,h),i.evaluated[f]=!1}),e.nodes[s]=i}return JSON.stringify(e)}function Pn(o){const n=JSON.parse(o),t=n.nodes;for(const e in t){const s={},i=t[e];s.x=i.x,s.y=i.y,s.type=i.type,s.inputs=[],s.outputs=[],s.evaluated=[];const l=i.type,d=G[l].inputs.map(c=>c.type),u=G[l].outputs.map(c=>c.type);d.forEach((c,p)=>{const f=i.inputs[p];s.inputs[p]=Bt(c,f)}),u.forEach((c,p)=>{const f=i.outputs[p];s.outputs[p]=Bt(c,f),s.evaluated[p]=!1}),t[e]=s}return n}function Dn(o,n){const t=new Blob([n],{type:"text/plain"}),e=document.createElement("a");e.href=URL.createObjectURL(t),e.download=`${o}`,e.click(),URL.revokeObjectURL(e)}function Hn(){const{nodes:o,connections:n,name:t}=_,e=Rn({nodes:o,connections:n,name:t});Dn(`${_.name}.json`,e)}function On(o){return o=o.replaceAll(" ","-"),o===""&&(o="defaultName"),o}function jn(o){_.name=On(o)}function Vt(o){const{nodes:n,connections:t,name:e}=Pn(o);_.nodes=n,_.connections=t,_.name=e}const qn=o=>T`
  <div class="toolbox-node" data-type=${o}>
    ${o}
  </div>
`,Fn=(o,n,t)=>T`
  <div class="node-input">
    <div
      class=${["node-input-circle","socket",["upload"].includes(t.input)?"hide-socket":""].join(" ")}
      data-id=${`${o}:in:${n}`}></div>
    <div class="node-input-name">${t.name}</div>
  </div>
`,Gn=(o,n,t)=>T`
  <div class="node-output">
    <div class="node-output-name">${t.name}</div>
    <div
      class="node-output-circle socket"
      data-id=${`${o}:out:${n}`}></div>
  </div>
`,Wn=(o,n)=>{const[t,e]=o,s=n.nodeTypes[e.type];if(!s)throw["The node type '",e.type,"' isn't a known one (name change?): ",Object.keys(n.nodeTypes)].join("");const i=n.selectedNodes.includes(t);return T`
    <div
      class=${["node",i?"selected-node":""].join(" ")}
      data-id=${t}
      style=${`left: ${e.x}px; top: ${e.y}px;`}>
      <div class="node-title">
        <div class="node-name">${s.name}</div>
        <div class="node-buttons">
          <div class="node-play" @click=${l=>Qt(t)}>►</div>
          <div class="node-delete" @click=${l=>Bn(t)}>x</div>
        </div>
      </div>
      ${s.inputs.map((l,d)=>Fn(t,d,l))}
      ${s.outputs.map((l,d)=>Gn(t,d,l))}
      <div class="node-view"></div>
    </div>
  `};function zn(o,n){const{nodes:t}=n,[e,s]=o.map(v=>v.split(":")[0]),[i,l]=o.map(v=>Number(v.split(":")[2])),{x:d,y:u,inputs:c}=t[e],{x:p,y:f}=t[s];if(n.dataflow===null)return;const h=(d+190)*n.dataflow.scale()+n.dataflow.x(),m=(u+37+18.5*(i+c.length))*n.dataflow.scale()+n.dataflow.y(),g=p*n.dataflow.scale()+n.dataflow.x(),r=(f+37+18.5*l)*n.dataflow.scale()+n.dataflow.y();let a=Math.abs(h-g);a=a/1.3;const y=`M ${h} ${m} C ${h+a} ${m}, ${g-a} ${r}, ${g} ${r}`;return ft`
    <path class="edge" stroke-width=${`${3*n.dataflow.scale()}px`} vector-effect="non-scaling-stroke" d=${y}/>
  `}function Yn(o,n){if(!document.querySelector(".socket"))return;const[t,[e,s]]=o;if(t===""||n.dataflow===null)return ft``;const{x:i,y:l,inputs:d}=n.nodes[t.split(":")[0]],u=Number(t.split(":")[2]),c=(i+190)*n.dataflow.scale()+n.dataflow.x(),p=(l+37+18.5*(u+d.length))*n.dataflow.scale()+n.dataflow.y();let f=Math.abs(c-e);f=f/1.3;const h=`M ${c} ${p} C ${c+f} ${p}, ${e-f} ${s}, ${e} ${s}`;return ft`
    <path class="edge" stroke-width=${`${3*n.dataflow.scale()}px`} vector-effect="non-scaling-stroke" d=${h}>
  `}const Kn=o=>!o||!o.start||!o.end?"":T`
    <div
      class="select-box"
      style=${`
        background: blue;
        opacity: 0.1;
        z-index: 100;
        position: absolute;
        left: ${o.start[0]}px;
        top:${o.start[1]}px;
        width: ${Math.abs(o.end[0]-o.start[0])}px;
        height:${Math.abs(o.end[1]-o.start[1])}px;
      `}>
    </div>
  `;function Xn(o){const n=o.selectedNodes[0],t=o.nodes[n],e=o.nodeTypes[t.type],s=(d,u)=>{t.inputs[u]=d},i={box:(d,u,c,p)=>T`
      <div class="node-editor-input">
        <span>${d}:</span>
        <input
          .value=${u}
          .disabled=${c}
          @blur=${gt}
          @input=${f=>s(f.target.value,p)}/>
      </div>
    `,check:(d,u,c,p)=>T`
      <div class="node-editor-input">
        <span>${d}:</span>
        <input
          type=checkbox
          .checked=${u?"checked":""}
          .disabled=${c}
          @blur=${gt}
          @input=${f=>s(!!f.target.checked,p)}/>
      </div>
    `,upload:(d,u,c,p)=>T`
      <div class="node-editor-input">
        <input type="file" @change=${f=>Mn(f,t,d,u,c,p)}/>
      </div>
    `},l=(d,u)=>{const c=o.connections.some(([f,h])=>h===`${n}:in:${u}`);return d.input&&d.input in i?i[d.input](d.name,t.inputs[u],c,u):T``};return T`
    <div class="node-editor-name">${t.type}</div>
    ${e.inputs.map(l)}
  `}function Zn(o){var e;let n=((e=document.querySelector(".toolbox-search"))==null?void 0:e.value)||"";n=n.toLowerCase();const t=Object.keys(o.nodeTypes).filter(s=>s.toLowerCase().includes(n));return T`
    <div class="root">
      <div class="menu">
        <div 
          class="menu-item menu-name" 
          contenteditable 
          spellcheck="false"
          @blur=${s=>jn(s.target.innerText)}>${o.name}</div>
        <div class="menu-item" @click=${()=>Hn()}>save</div>
        <div class="menu-item" @click=${()=>document.getElementById("load_file").click()}>load</div>
        <!-- hidden -->
        <input type="file" accept=".json" style="display:none;" id="load_file" name="file" @input=${s=>{const i=s.target.files[0];Jn(i).then(l=>Vt(l))}}>

        <div class="menu-item dropdown-container">
          list menu
          <div class="dropdown-list">
            <span>
              option 1
            </span>
            <span>
              option 2
            </span>
          </div>
        </div>
        <a class="menu-item" href="https://github.com/leomcelroy/yada" target="_blank">github</a>
      </div>
      <div class="bottom-container">
        <div class="toolbox">
          <div class="toolbox-search-container">
            <input class="toolbox-search" @input=${gt}></input>
            <div class="toolbox-search-results">
              ${t.map(qn)}
            </div>
          </div>
          ${o.selectedNodes.length===1?T`<div class="node-input-editor">
                  ${Xn(o)}
                  <div>state: ${JSON.stringify(o.nodes[o.selectedNodes[0]].state)}</div>
                </div>`:""}
        </div>
        <div class="dataflow">
          <svg class="edges">
            <g>
              ${o.connections.map(s=>zn(s,o))}
              ${Yn(o.tempEdge,o)}
            </g>
          </svg>
          <div class="nodes">
            <div class="transform-group">
              ${Sn(Object.entries(o.nodes),s=>s[0],s=>Wn(s,o))}
              
              ${Kn(o.selectBox)}
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function Jn(o){return new Promise((n,t)=>{let e=new FileReader;e.onload=s=>n(e.result),e.readAsText(o)})}const gt=()=>{},Ut=(o,n)=>{let t=document.querySelector(n).getBoundingClientRect(),e=o.clientX-t.left,s=o.clientY-t.top;return[e,s]};function Qn(o,n){let t=null,e=null;const s=n.dataflow;n.selectBox={start:[0,0],end:[0,0]},o("mousedown",".nodes",l=>{if(!l.shiftKey)return;const[d,u]=Ut(l,".dataflow");t=s.getPoint(d,u)}),o("mousemove","",l=>{if(document.body.classList.add("no-select"),!l.shiftKey||t===null)return;const[d,u]=Ut(l,".dataflow");e=s.getPoint(d,u),n.selectBox.start=[Math.min(t[0],e[0]),Math.min(t[1],e[1])],n.selectBox.end=[Math.max(t[0],e[0]),Math.max(t[1],e[1])]});function i(l,d){let{start:u,end:c}=d;return l.x>u.x&&l.x<c.x&&l.y>u.y&&l.y<c.y||l.x>u.x&&l.x<c.x&&l.y<u.y&&l.y>c.y||l.x<u.x&&l.x>c.x&&l.y>u.y&&l.y<c.y||l.x<u.x&&l.x>c.x&&l.y<u.y&&l.y>c.y}o("mouseup","",l=>{!l.shiftKey||(document.body.classList.remove("no-select"),t&&e&&Object.entries(n.nodes).forEach(([d,u])=>{i(u,{start:{x:t[0],y:t[1]},end:{x:e[0],y:e[1]}})&&!n.selectedNodes.includes(d)&&n.selectedNodes.push(d)}),t=null,e=null,n.selectBox.start=t,n.selectBox.end=e)})}function Vn(o,n=[]){let t=o[0],e=t.name.split(".");if(e[0],e[e.length-1],n.length>0&&n.includes(enxtension))throw"Extension not recongized: "+e;ts(t)}function ts(o){var n=new FileReader;n.readAsText(o),n.onloadend=t=>{const e=n.result;try{Vt(e)}catch{}}}function es(o,n){o("drop","",function(t){let s=t.dataTransfer.files;Vn(s),It(t)}),o("dragover","",function(t){It(t)})}function It(o){return o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.cancelBubble=!0,o.returnValue=!1,!1}const te=o=>o.composedPath()[0],ns=(o,n)=>te(o).matches(n),ss=o=>(n,t,e)=>{o.addEventListener(n,s=>{s.trigger=te(s),(t===""||ns(s,t))&&e(s)})};function os(o){let n=!1;const t=r=>{n=r},e=ss(o),s=o.querySelectorAll(".transform-group"),i=r=>{let a=o.getBoundingClientRect(),y=r.clientX-a.left,v=r.clientY-a.top;return[y,v]};let l=!1,d=1,u=0,c=0,p={x:0,y:0};function f(r){r.forEach(a=>{a.style.transformOrigin=`${0}px ${0}px`,a.style.transform="translate("+u+"px, "+c+"px) scale("+d+")"})}function h(r,a){let y=(r-u)/d,v=(a-c)/d;return[y,v]}e("mousedown","",r=>{if(n||r.shiftKey)return;const[a,y]=i(r);l=!0,p={x:a-u,y:y-c},r.detail===2&&console.log(a,y,h(a,y))}),e("mousemove","",r=>{if(n||!l)return;const[a,y]=i(r);u=a-p.x,c=y-p.y,f(s)}),e("mouseup","",r=>{l=!1}),e("mouseout","",r=>{l=!1}),e("wheel","",r=>{const[a,y]=i(r);let v=(a-u)/d,$=(y-c)/d;Math.sign(r.deltaY)<0?d*=1.03:d/=1.03,u=a-v*d,c=y-$*d,f(s),r.preventDefault()});function m(r){const a=o.getBoundingClientRect(),y=r.x[1]-r.x[0],v=r.y[1]-r.y[0],$=a.width/y,w=a.height/v,A=Math.min($,w)*.9;d=A;const E={x:(r.x[0]+r.x[1])/2*A-a.width/2,y:(r.y[0]+r.y[1])/2*A-a.height/2};u=-E.x,c=-E.y,f(s)}function g(){if(o===null)return null;const{left:r,right:a,bottom:y,top:v,width:$,height:w}=o.getBoundingClientRect(),A=h($,w),E=h(0,w),I=h($,0),M=h(0,0);return{rt:A,lt:E,rb:I,lb:M}}return{scale:()=>d,x:()=>u,y:()=>c,corners:g,getPoint:h,setScaleXY:m,togglePanZoom:t}}function Lt(o){_.connections=_.connections.filter((n,t)=>t!==o)}function is(o,n){_.connections.push([o,n])}function rs(o,n,t){const e=_.nodes[o];!e||(e.x+=n,e.y+=t)}const ee=o=>o.composedPath()[0],as=(o,n)=>ee(o).matches(n),Q=(o,n)=>o.composedPath().some(t=>t.matches&&t.matches(n)),ls=o=>(n,t,e)=>{o.addEventListener(n,s=>{s.trigger=ee(s),(t===""||as(s,t))&&e(s)})};function cs(o,n){const t=document.querySelector(o),e=document.querySelector(n),s=t.getBoundingClientRect(),i=e.getBoundingClientRect(),l=s.top-i.top;return[s.left-i.left,l]}const ne=(o,n)=>{let t=document.querySelector(n).getBoundingClientRect(),e=o.clientX-t.left,s=o.clientY-t.top;return[e,s]};function us(o,n){let t=!1,e="",s="";o("mousedown",".toolbox-node",i=>{s=i.target.dataset.type,t=!0,e=Math.random().toString(16).slice(2)}),o("mousemove","",i=>{if(!t)return;const[l,d]=n.dataflow.getPoint(...ne(i,".dataflow")),{inputs:u,outputs:c}=n.nodeTypes[s],p=u.map(h=>mt[h.type]),f=c.map(h=>mt[h.type]);n.nodes[e]={type:s,state:{},x:l,y:d,inputs:p,outputs:f,evaluated:new Array(f.length).fill(!1)}}),o("mouseup","",i=>{t&&Q(i,".toolbox")&&delete n.nodes[e],e!==""&&Q(i,".dataflow")&&Qt(e),e="",t=!1})}function ds(o,n){let t="",e="",s=-1;o("mousedown",".node-input-circle",i=>{const l=i.target.dataset.id,d=n.connections.find(u=>u[1]===l);s=n.connections.findIndex(u=>u[1]===l),d&&(t=d[0])}),o("mousedown",".node-output-circle",i=>{t=i.target.dataset.id}),o("mouseup",".node-input-circle",i=>{e=i.target.dataset.id}),o("wheel","",i=>{}),o("mousemove","",i=>{t!==""&&(document.querySelector(`[data-id="${t}"]`).getBoundingClientRect(),cs(`[data-id="${t}"]`,".dataflow"),n.tempEdge=[t,ne(i,".dataflow")]),s!==-1&&(Lt(s),s=-1)}),o("mouseup","",i=>{t!==""&&(t!==""&&e!==""&&(s=n.connections.findIndex(l=>l[1]===e),s!==-1&&Lt(s),is(t,e)),t="",e="",s=-1,n.tempEdge=["",[0,0]])})}function fs(o,n){let t=!1,e="";o("mousedown","",s=>{if(document.body.classList.add("no-select"),Q(s,".socket")){n.dataflow.togglePanZoom(!0);return}!Q(s,".dataflow")||(t=s.composedPath().find(i=>i.matches&&i.matches(".node")),Q(s,".node")?(n.dataflow.togglePanZoom(!0),e=t.dataset.id,n.selectedNodes.includes(e)&&s.detail===2||(!n.selectedNodes.includes(e)&&!s.shiftKey?n.selectedNodes=[e]:!n.selectedNodes.includes(e)&&s.shiftKey&&n.selectedNodes.push(e))):s.shiftKey||(n.selectedNodes=[]))}),o("mousemove","",s=>{if(!t)return;const i=n.dataflow.scale();n.selectedNodes.forEach(l=>{rs(l,s.movementX/i,s.movementY/i)})}),o("mouseup","",s=>{document.body.classList.remove("no-select"),t=!1,e="",n.dataflow.togglePanZoom(!1)})}function hs(){document.addEventListener("keydown",o=>{const n=[61,107,173,109,187,189];(o.ctrlKey||o.metaKey)&&n.some(t=>o.which===t)&&o.preventDefault()}),document.addEventListener("mousewheel",o=>{(o.ctrlKey||o.metaKey)&&o.preventDefault()})}function ps(o){o.dataflow=os(document.querySelector(".dataflow"));const n=document.querySelector("body"),t=ls(n);fs(t,o),ds(t,o),us(t,o),Qn(t,o),es(t),hs()}const se=()=>he(Zn(_),document.body);window.LOG_STATE=()=>console.log(_);const oe=o=>{se(),requestAnimationFrame(oe)};window.addEventListener("load",()=>{se(),ps(_),requestAnimationFrame(oe)});
