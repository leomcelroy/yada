(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var lt;const ot=window,j=ot.trustedTypes,vt=j?j.createPolicy("lit-html",{createHTML:s=>s}):void 0,B=`lit$${(Math.random()+"").slice(9)}$`,mt="?"+B,fe=`<${mt}>`,q=document,V=(s="")=>q.createComment(s),tt=s=>s===null||typeof s!="object"&&typeof s!="function",It=Array.isArray,Pt=s=>It(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",X=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,yt=/-->/g,$t=/>/g,P=RegExp(`>|[ 	
\f\r](?:([^\\s"'>=/]+)([ 	
\f\r]*=[ 	
\f\r]*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),wt=/'/g,At=/"/g,Ht=/^(?:script|style|textarea|title)$/i,Dt=s=>(n,...t)=>({_$litType$:s,strings:n,values:t}),k=Dt(1),dt=Dt(2),W=Symbol.for("lit-noChange"),N=Symbol.for("lit-nothing"),bt=new WeakMap,O=q.createTreeWalker(q,129,null,!1),Ot=(s,n)=>{const t=s.length-1,e=[];let o,i=n===2?"<svg>":"",l=X;for(let u=0;u<t;u++){const c=s[u];let p,f,h=-1,m=0;for(;m<c.length&&(l.lastIndex=m,f=l.exec(c),f!==null);)m=l.lastIndex,l===X?f[1]==="!--"?l=yt:f[1]!==void 0?l=$t:f[2]!==void 0?(Ht.test(f[2])&&(o=RegExp("</"+f[2],"g")),l=P):f[3]!==void 0&&(l=P):l===P?f[0]===">"?(l=o!=null?o:X,h=-1):f[1]===void 0?h=-2:(h=l.lastIndex-f[2].length,p=f[1],l=f[3]===void 0?P:f[3]==='"'?At:wt):l===At||l===wt?l=P:l===yt||l===$t?l=X:(l=P,o=void 0);const g=l===P&&s[u+1].startsWith("/>")?" ":"";i+=l===X?c+fe:h>=0?(e.push(p),c.slice(0,h)+"$lit$"+c.slice(h)+B+g):c+B+(h===-2?(e.push(void 0),u):g)}const d=i+(s[t]||"<?>")+(n===2?"</svg>":"");if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return[vt!==void 0?vt.createHTML(d):d,e]};class et{constructor({strings:n,_$litType$:t},e){let o;this.parts=[];let i=0,l=0;const d=n.length-1,u=this.parts,[c,p]=Ot(n,t);if(this.el=et.createElement(c,e),O.currentNode=this.el.content,t===2){const f=this.el.content,h=f.firstChild;h.remove(),f.append(...h.childNodes)}for(;(o=O.nextNode())!==null&&u.length<d;){if(o.nodeType===1){if(o.hasAttributes()){const f=[];for(const h of o.getAttributeNames())if(h.endsWith("$lit$")||h.startsWith(B)){const m=p[l++];if(f.push(h),m!==void 0){const g=o.getAttribute(m.toLowerCase()+"$lit$").split(B),r=/([.?@])?(.*)/.exec(m);u.push({type:1,index:i,name:r[2],strings:g,ctor:r[1]==="."?qt:r[1]==="?"?Wt:r[1]==="@"?Ft:nt})}else u.push({type:6,index:i})}for(const h of f)o.removeAttribute(h)}if(Ht.test(o.tagName)){const f=o.textContent.split(B),h=f.length-1;if(h>0){o.textContent=j?j.emptyScript:"";for(let m=0;m<h;m++)o.append(f[m],V()),O.nextNode(),u.push({type:2,index:++i});o.append(f[h],V())}}}else if(o.nodeType===8)if(o.data===mt)u.push({type:2,index:i});else{let f=-1;for(;(f=o.data.indexOf(B,f+1))!==-1;)u.push({type:7,index:i}),f+=B.length-1}i++}}static createElement(n,t){const e=q.createElement("template");return e.innerHTML=n,e}}function D(s,n,t=s,e){var o,i,l,d;if(n===W)return n;let u=e!==void 0?(o=t._$Co)===null||o===void 0?void 0:o[e]:t._$Cl;const c=tt(n)?void 0:n._$litDirective$;return(u==null?void 0:u.constructor)!==c&&((i=u==null?void 0:u._$AO)===null||i===void 0||i.call(u,!1),c===void 0?u=void 0:(u=new c(s),u._$AT(s,t,e)),e!==void 0?((l=(d=t)._$Co)!==null&&l!==void 0?l:d._$Co=[])[e]=u:t._$Cl=u),u!==void 0&&(n=D(s,u._$AS(s,n.values),u,e)),n}class jt{constructor(n,t){this.u=[],this._$AN=void 0,this._$AD=n,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(n){var t;const{el:{content:e},parts:o}=this._$AD,i=((t=n==null?void 0:n.creationScope)!==null&&t!==void 0?t:q).importNode(e,!0);O.currentNode=i;let l=O.nextNode(),d=0,u=0,c=o[0];for(;c!==void 0;){if(d===c.index){let p;c.type===2?p=new G(l,l.nextSibling,this,n):c.type===1?p=new c.ctor(l,c.name,c.strings,this,n):c.type===6&&(p=new Gt(l,this,n)),this.u.push(p),c=o[++u]}d!==(c==null?void 0:c.index)&&(l=O.nextNode(),d++)}return i}p(n){let t=0;for(const e of this.u)e!==void 0&&(e.strings!==void 0?(e._$AI(n,e,t),t+=e.strings.length-2):e._$AI(n[t])),t++}}class G{constructor(n,t,e,o){var i;this.type=2,this._$AH=N,this._$AN=void 0,this._$AA=n,this._$AB=t,this._$AM=e,this.options=o,this._$Cm=(i=o==null?void 0:o.isConnected)===null||i===void 0||i}get _$AU(){var n,t;return(t=(n=this._$AM)===null||n===void 0?void 0:n._$AU)!==null&&t!==void 0?t:this._$Cm}get parentNode(){let n=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&n.nodeType===11&&(n=t.parentNode),n}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(n,t=this){n=D(this,n,t),tt(n)?n===N||n==null||n===""?(this._$AH!==N&&this._$AR(),this._$AH=N):n!==this._$AH&&n!==W&&this.g(n):n._$litType$!==void 0?this.$(n):n.nodeType!==void 0?this.T(n):Pt(n)?this.k(n):this.g(n)}O(n,t=this._$AB){return this._$AA.parentNode.insertBefore(n,t)}T(n){this._$AH!==n&&(this._$AR(),this._$AH=this.O(n))}g(n){this._$AH!==N&&tt(this._$AH)?this._$AA.nextSibling.data=n:this.T(q.createTextNode(n)),this._$AH=n}$(n){var t;const{values:e,_$litType$:o}=n,i=typeof o=="number"?this._$AC(n):(o.el===void 0&&(o.el=et.createElement(o.h,this.options)),o);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===i)this._$AH.p(e);else{const l=new jt(i,this),d=l.v(this.options);l.p(e),this.T(d),this._$AH=l}}_$AC(n){let t=bt.get(n.strings);return t===void 0&&bt.set(n.strings,t=new et(n)),t}k(n){It(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let e,o=0;for(const i of n)o===t.length?t.push(e=new G(this.O(V()),this.O(V()),this,this.options)):e=t[o],e._$AI(i),o++;o<t.length&&(this._$AR(e&&e._$AB.nextSibling,o),t.length=o)}_$AR(n=this._$AA.nextSibling,t){var e;for((e=this._$AP)===null||e===void 0||e.call(this,!1,!0,t);n&&n!==this._$AB;){const o=n.nextSibling;n.remove(),n=o}}setConnected(n){var t;this._$AM===void 0&&(this._$Cm=n,(t=this._$AP)===null||t===void 0||t.call(this,n))}}class nt{constructor(n,t,e,o,i){this.type=1,this._$AH=N,this._$AN=void 0,this.element=n,this.name=t,this._$AM=o,this.options=i,e.length>2||e[0]!==""||e[1]!==""?(this._$AH=Array(e.length-1).fill(new String),this.strings=e):this._$AH=N}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(n,t=this,e,o){const i=this.strings;let l=!1;if(i===void 0)n=D(this,n,t,0),l=!tt(n)||n!==this._$AH&&n!==W,l&&(this._$AH=n);else{const d=n;let u,c;for(n=i[0],u=0;u<i.length-1;u++)c=D(this,d[e+u],t,u),c===W&&(c=this._$AH[u]),l||(l=!tt(c)||c!==this._$AH[u]),c===N?n=N:n!==N&&(n+=(c!=null?c:"")+i[u+1]),this._$AH[u]=c}l&&!o&&this.j(n)}j(n){n===N?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,n!=null?n:"")}}class qt extends nt{constructor(){super(...arguments),this.type=3}j(n){this.element[this.name]=n===N?void 0:n}}const he=j?j.emptyScript:"";class Wt extends nt{constructor(){super(...arguments),this.type=4}j(n){n&&n!==N?this.element.setAttribute(this.name,he):this.element.removeAttribute(this.name)}}class Ft extends nt{constructor(n,t,e,o,i){super(n,t,e,o,i),this.type=5}_$AI(n,t=this){var e;if((n=(e=D(this,n,t,0))!==null&&e!==void 0?e:N)===W)return;const o=this._$AH,i=n===N&&o!==N||n.capture!==o.capture||n.once!==o.once||n.passive!==o.passive,l=n!==N&&(o===N||i);i&&this.element.removeEventListener(this.name,this,o),l&&this.element.addEventListener(this.name,this,n),this._$AH=n}handleEvent(n){var t,e;typeof this._$AH=="function"?this._$AH.call((e=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&e!==void 0?e:this.element,n):this._$AH.handleEvent(n)}}class Gt{constructor(n,t,e){this.element=n,this.type=6,this._$AN=void 0,this._$AM=t,this.options=e}get _$AU(){return this._$AM._$AU}_$AI(n){D(this,n)}}const pe={P:"$lit$",A:B,M:mt,C:1,L:Ot,R:jt,D:Pt,V:D,I:G,H:nt,N:Wt,U:Ft,B:qt,F:Gt},_t=ot.litHtmlPolyfillSupport;_t==null||_t(et,G),((lt=ot.litHtmlVersions)!==null&&lt!==void 0?lt:ot.litHtmlVersions=[]).push("2.4.0");const me=(s,n,t)=>{var e,o;const i=(e=t==null?void 0:t.renderBefore)!==null&&e!==void 0?e:n;let l=i._$litPart$;if(l===void 0){const d=(o=t==null?void 0:t.renderBefore)!==null&&o!==void 0?o:null;i._$litPart$=l=new G(n.insertBefore(V(),d),d,void 0,t!=null?t:{})}return l._$AI(s),l},ge={name:"adder",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],outputs:[{name:"sum",type:"number"}],onUpdate(s){return`
      <div>hello world</div>
      <div>the answer is ${s.outputs[0]}</div>
    `},func:(s,n)=>[s+n]},ve={name:"async_adder",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],outputs:[{name:"sum",type:"number"}],onUpdate(s){return`
      <div>hello world</div>
      <div>the answer is ${s.outputs[0]}</div>
    `},func:async(s,n)=>{const t=new Promise(e=>{setTimeout(()=>{e(s+n)},1e3)});return await Promise.all([t])}};function ye(){self.onmessage=function(s){const n=s.data,t=n.buf,e=n.w,o=n.h;var i=new Float32Array(e*o);function l(y,v,$,w){return($-w)*($-w)+y[w][v]*y[w][v]}function d(y,v,$,w){return(y[$][v]*y[$][v]-y[w][v]*y[w][v]+$*$-w*w)/(2*($-w))}for(var u=[],c=0;c<o;++c)u[c]=new Uint32Array(e);for(var c=0;c<o;++c)new Uint32Array(e);for(var c=0;c<o;++c)new Uint32Array(e);for(var p=new Uint32Array(o),f=new Uint32Array(o),h,c=0;c<o;++c){for(var m=-e,g=0;g<e;++g)t[(o-1-c)*e*4+g*4+0]!=0?(u[c][g]=0,m=g):u[c][g]=g-m;m=2*e;for(var g=e-1;g>=0;--g)t[(o-1-c)*e*4+g*4+0]!=0?m=g:(h=m-g,h<u[c][g]&&(u[c][g]=h))}for(var g=0;g<e;++g){var r=0;p[0]=0,f[0]=0;for(var c=1;c<o;++c){for(;r>=0&&l(u,g,p[r],f[r])>l(u,g,p[r],c);)r-=1;if(r<0)r=0,f[0]=c;else{var a=1+d(u,g,f[r],c);a<o&&(r+=1,f[r]=c,p[r]=a)}}for(var c=o-1;c>=0;--c)h=Math.sqrt(l(u,g,c,f[r])),i[(o-1-c)*e+g]=h,c==p[r]&&(r-=1)}self.postMessage([i,n.w,n.h]),self.close()}}const $e={name:"img distance",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"distances",type:"img_float32"}],func:async s=>{const n=new Blob(["("+ye.toString()+"())"]),t=window.URL.createObjectURL(n),e=new Worker(t),o=new Promise(u=>{e.onmessage=c=>{const p=c.data,f={data:p[0],width:p[1],height:p[2]};u(f)}}),i=s.data,l=s.width,d=s.height;return e.postMessage({buf:i,w:l,h:d}),await Promise.all([o])}};function we(){function s(n){var t=n.height,e=n.width,o=n.data,i=new Uint8ClampedArray(t*e*4),l,d,u,c,p,f,h,m,g,r,a;for(r=1;r<t-1;++r)for(a=1;a<e-1;++a)l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],u=o[(t-1-r)*e*4+(a+1)*4+0]+o[(t-1-r)*e*4+(a+1)*4+1]+o[(t-1-r)*e*4+(a+1)*4+2],p=o[(t-2-r)*e*4+a*4+0]+o[(t-2-r)*e*4+a*4+1]+o[(t-2-r)*e*4+a*4+2],g=o[(t-2-r)*e*4+(a+1)*4+0]+o[(t-2-r)*e*4+(a+1)*4+1]+o[(t-2-r)*e*4+(a+1)*4+2],d=o[(t-1-r)*e*4+(a-1)*4+0]+o[(t-1-r)*e*4+(a-1)*4+1]+o[(t-1-r)*e*4+(a-1)*4+2],c=o[(t-r)*e*4+a*4+0]+o[(t-r)*e*4+a*4+1]+o[(t-r)*e*4+a*4+2],f=o[(t-r)*e*4+(a-1)*4+0]+o[(t-r)*e*4+(a-1)*4+1]+o[(t-r)*e*4+(a-1)*4+2],h=o[(t-r)*e*4+(a+1)*4+0]+o[(t-r)*e*4+(a+1)*4+1]+o[(t-r)*e*4+(a+1)*4+2],m=o[(t-2-r)*e*4+(a-1)*4+0]+o[(t-2-r)*e*4+(a-1)*4+1]+o[(t-2-r)*e*4+(a-1)*4+2],l!=u||l!=p||l!=g||l!=d||l!=c||l!=f||l!=h||l!=m?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);for(r=1;r<t-1;++r)a=e-1,l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],d=o[(t-1-r)*e*4+(a-1)*4+0]+o[(t-1-r)*e*4+(a-1)*4+1]+o[(t-1-r)*e*4+(a-1)*4+2],f=o[(t-r)*e*4+(a-1)*4+0]+o[(t-r)*e*4+(a-1)*4+1]+o[(t-r)*e*4+(a-1)*4+2],m=o[(t-2-r)*e*4+(a-1)*4+0]+o[(t-2-r)*e*4+(a-1)*4+1]+o[(t-2-r)*e*4+(a-1)*4+2],c=o[(t-r)*e*4+a*4+0]+o[(t-r)*e*4+a*4+1]+o[(t-r)*e*4+a*4+2],p=o[(t-2-r)*e*4+a*4+0]+o[(t-2-r)*e*4+a*4+1]+o[(t-2-r)*e*4+a*4+2],l!=d||l!=p||l!=m||l!=c||l!=f?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),a=0,l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],u=o[(t-1-r)*e*4+(a+1)*4+0]+o[(t-1-r)*e*4+(a+1)*4+1]+o[(t-1-r)*e*4+(a+1)*4+2],h=o[(t-r)*e*4+(a+1)*4+0]+o[(t-r)*e*4+(a+1)*4+1]+o[(t-r)*e*4+(a+1)*4+2],g=o[(t-2-r)*e*4+(a+1)*4+0]+o[(t-2-r)*e*4+(a+1)*4+1]+o[(t-2-r)*e*4+(a+1)*4+2],c=o[(t-r)*e*4+a*4+0]+o[(t-r)*e*4+a*4+1]+o[(t-r)*e*4+a*4+2],p=o[(t-2-r)*e*4+a*4+0]+o[(t-2-r)*e*4+a*4+1]+o[(t-2-r)*e*4+a*4+2],l!=u||l!=p||l!=g||l!=c||l!=h?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);for(a=1;a<e-1;++a)r=t-1,l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],d=o[(t-1-r)*e*4+(a-1)*4+0]+o[(t-1-r)*e*4+(a-1)*4+1]+o[(t-1-r)*e*4+(a-1)*4+2],u=o[(t-1-r)*e*4+(a+1)*4+0]+o[(t-1-r)*e*4+(a+1)*4+1]+o[(t-1-r)*e*4+(a+1)*4+2],f=o[(t-r)*e*4+(a-1)*4+0]+o[(t-r)*e*4+(a-1)*4+1]+o[(t-r)*e*4+(a-1)*4+2],c=o[(t-r)*e*4+a*4+0]+o[(t-r)*e*4+a*4+1]+o[(t-r)*e*4+a*4+2],h=o[(t-r)*e*4+(a+1)*4+0]+o[(t-r)*e*4+(a+1)*4+1]+o[(t-r)*e*4+(a+1)*4+2],l!=d||l!=u||l!=f||l!=c||l!=h?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=0,l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],d=o[(t-1-r)*e*4+(a-1)*4+0]+o[(t-1-r)*e*4+(a-1)*4+1]+o[(t-1-r)*e*4+(a-1)*4+2],u=o[(t-1-r)*e*4+(a+1)*4+0]+o[(t-1-r)*e*4+(a+1)*4+1]+o[(t-1-r)*e*4+(a+1)*4+2],m=o[(t-2-r)*e*4+(a-1)*4+0]+o[(t-2-r)*e*4+(a-1)*4+1]+o[(t-2-r)*e*4+(a-1)*4+2],p=o[(t-2-r)*e*4+a*4+0]+o[(t-2-r)*e*4+a*4+1]+o[(t-2-r)*e*4+a*4+2],g=o[(t-2-r)*e*4+(a+1)*4+0]+o[(t-2-r)*e*4+(a+1)*4+1]+o[(t-2-r)*e*4+(a+1)*4+2],l!=d||l!=u||l!=m||l!=p||l!=g?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255);return r=0,a=0,l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],u=o[(t-1-r)*e*4+(a+1)*4+0]+o[(t-1-r)*e*4+(a+1)*4+1]+o[(t-1-r)*e*4+(a+1)*4+2],p=o[(t-2-r)*e*4+a*4+0]+o[(t-2-r)*e*4+a*4+1]+o[(t-2-r)*e*4+a*4+2],g=o[(t-2-r)*e*4+(a+1)*4+0]+o[(t-2-r)*e*4+(a+1)*4+1]+o[(t-2-r)*e*4+(a+1)*4+2],l!=u||l!=p||l!=g?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=0,a=e-1,l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],d=o[(t-1-r)*e*4+(a-1)*4+0]+o[(t-1-r)*e*4+(a-1)*4+1]+o[(t-1-r)*e*4+(a-1)*4+2],p=o[(t-2-r)*e*4+a*4+0]+o[(t-2-r)*e*4+a*4+1]+o[(t-2-r)*e*4+a*4+2],m=o[(t-2-r)*e*4+(a-1)*4+0]+o[(t-2-r)*e*4+(a-1)*4+1]+o[(t-2-r)*e*4+(a-1)*4+2],l!=d||l!=p||l!=m?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=t-1,a=0,l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],u=o[(t-1-r)*e*4+(a+1)*4+0]+o[(t-1-r)*e*4+(a+1)*4+1]+o[(t-1-r)*e*4+(a+1)*4+2],c=o[(t-r)*e*4+a*4+0]+o[(t-r)*e*4+a*4+1]+o[(t-r)*e*4+a*4+2],h=o[(t-r)*e*4+(a+1)*4+0]+o[(t-r)*e*4+(a+1)*4+1]+o[(t-r)*e*4+(a+1)*4+2],l!=u||l!=c||l!=h?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),r=t-1,a=e-1,l=o[(t-1-r)*e*4+a*4+0]+o[(t-1-r)*e*4+a*4+1]+o[(t-1-r)*e*4+a*4+2],d=o[(t-1-r)*e*4+(a-1)*4+0]+o[(t-1-r)*e*4+(a-1)*4+1]+o[(t-1-r)*e*4+(a-1)*4+2],c=o[(t-r)*e*4+a*4+0]+o[(t-r)*e*4+a*4+1]+o[(t-r)*e*4+a*4+2],f=o[(t-r)*e*4+(a-1)*4+0]+o[(t-r)*e*4+(a-1)*4+1]+o[(t-r)*e*4+(a-1)*4+2],l!=d||l!=c||l!=f?(i[(t-1-r)*e*4+a*4+0]=255,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255):l==0?(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=0,i[(t-1-r)*e*4+a*4+2]=255,i[(t-1-r)*e*4+a*4+3]=255):(i[(t-1-r)*e*4+a*4+0]=0,i[(t-1-r)*e*4+a*4+1]=255,i[(t-1-r)*e*4+a*4+2]=0,i[(t-1-r)*e*4+a*4+3]=255),new ImageData(i,e,t)}self.onmessage=function(n){const t=n.data;buf=s(t.img),self.postMessage([buf]),self.close()}}const Ae={name:"img edge detect",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(s){const n=s.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async s=>{const n=new Blob(["("+we.toString()+"())"]),t=window.URL.createObjectURL(n),e=new Worker(t),o=new Promise(i=>{e.onmessage=l=>{i(l.data[0])}});return e.postMessage({img:s}),await Promise.all([o])}};function be(){function s(n,t){for(var e=n.data,o=n.width,i=n.height,l=new Uint8ClampedArray(4*i*o),d=0;d<i;++d)for(var u=0;u<o;++u)e[(i-1-d)*o+u]<=t?(l[(i-1-d)*o*4+u*4+0]=255,l[(i-1-d)*o*4+u*4+1]=255,l[(i-1-d)*o*4+u*4+2]=255,l[(i-1-d)*o*4+u*4+3]=255):(l[(i-1-d)*o*4+u*4+0]=0,l[(i-1-d)*o*4+u*4+1]=0,l[(i-1-d)*o*4+u*4+2]=0,l[(i-1-d)*o*4+u*4+3]=255);return new ImageData(l,o,i)}self.onmessage=function(n){const t=n.data;buf=s(t.img,t.offset),self.postMessage([buf]),self.close()}}const _e={name:"img offset",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"offset",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(s){const n=s.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(s,n)=>{const t=new Blob(["("+be.toString()+"())"]),e=window.URL.createObjectURL(t),o=new Worker(e),i=new Promise(l=>{o.onmessage=d=>{l(d.data[0])}});return o.postMessage({img:s,offset:n}),await Promise.all([i])}},xe={name:"read png",inputs:[{name:"imageRGBA",type:"img_uint8",input:"upload"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],func:s=>[s]};var xt=100;function Ne(s,n){const t=document.createElement("canvas");t.width=n,t.height=s;const e=t.getContext("2d");e.beginPath(),e.rect(0,0,n,s),e.fillStyle="black",e.fill();var o=40,i=e.createLinearGradient(0,0,o,0);i.addColorStop(0,"black"),i.addColorStop(.5,"red"),i.addColorStop(1,"green"),e.fillStyle=i,e.fillRect(0,0,o,o);const l=10;return e.beginPath(),e.strokeStyle="#AAAAAA",e.arc(s/2,n/2,n/2-l,0,2*Math.PI),e.stroke(),e.getImageData(0,0,n,s)}const Te={name:"img sample",inputs:[{name:"height",type:"number",input:"box"},{name:"width",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(s){const n=s.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(s,n)=>{s==0&&(s=xt),n==0&&(n=xt);var t=Ne(s,n);return[t]}};function ke(){self.onmessage=function(s){const n=s.data,t=n.buf,e=n.w,o=n.h,i=n.threshold;let l,d,u,c,p;for(var f=0;f<o;++f)for(var h=0;h<e;++h){l=t[(o-1-f)*e*4+h*4+0],d=t[(o-1-f)*e*4+h*4+1],u=t[(o-1-f)*e*4+h*4+2],c=t[(o-1-f)*e*4+h*4+3],p=(l+d+u)/(3*255);let m;c===0||p>=i?m=255:m=0,t[(o-1-f)*e*4+h*4+0]=m,t[(o-1-f)*e*4+h*4+1]=m,t[(o-1-f)*e*4+h*4+2]=m,t[(o-1-f)*e*4+h*4+3]=255}self.postMessage([t,e,o]),self.close()}}const Ce={name:"thresholdRGBA",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"threshold",type:"number",input:"box"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(s){const n=s.outputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:async(s,n)=>{const t=new Blob(["("+ke.toString()+"())"]),e=window.URL.createObjectURL(t),o=new Worker(e),i=new Promise(c=>{o.onmessage=p=>{const f=p.data,h={data:f[0],width:f[1],height:f[2]};c(h)}}),l=s.data,d=s.width,u=s.height;return o.postMessage({buf:l,w:d,h:u,threshold:n}),await Promise.all([i])}};function Ee(){function s(n,t=1,e=!0){var o=n.height,i=n.width,l=n.data,d=0,u=128,c=64,p=1,f=128,h=64,m=[];function g(b,_){if(l[(o-1-b)*i*4+_*4+d]!=0||l[(o-1-b)*i*4+_*4+p]!=0)for(m[m.length]=[[_,b]];;)if(l[(o-1-b)*i*4+_*4+d]&u)l[(o-1-b)*i*4+_*4+d]=l[(o-1-b)*i*4+_*4+d]&~u,b+=1,m[m.length-1][m[m.length-1].length]=[_,b];else if(l[(o-1-b)*i*4+_*4+d]&c)l[(o-1-b)*i*4+_*4+d]=l[(o-1-b)*i*4+_*4+d]&~c,b-=1,m[m.length-1][m[m.length-1].length]=[_,b];else if(l[(o-1-b)*i*4+_*4+p]&f)l[(o-1-b)*i*4+_*4+p]=l[(o-1-b)*i*4+_*4+p]&~f,_+=1,m[m.length-1][m[m.length-1].length]=[_,b];else if(l[(o-1-b)*i*4+_*4+p]&h)l[(o-1-b)*i*4+_*4+p]=l[(o-1-b)*i*4+_*4+p]&~h,_-=1,m[m.length-1][m[m.length-1].length]=[_,b];else break}for(var r=1;r<o-1;++r)a=0,g(r,a),a=i-1,g(r,a);for(var a=1;a<i-1;++a)r=0,g(r,a),r=o-1,g(r,a);for(var r=1;r<o-1;++r)for(var a=1;a<i-1;++a)g(r,a);for(var y=t,v=[],$=0;$<m.length;++$){var w=m[$][0][0],A=m[$][0][1];v[v.length]=[[w,A]];for(var C=w,R=A,M=1,I=1;I<m[$].length;++I){var z=E,it=S,E=m[$][I][0],S=m[$][I][1];if(M==1)C+=E,R+=S,M+=1;else{var ae=C/M,le=R/M,rt=ae-w,at=le-A,U=Math.sqrt(rt*rt+at*at),ce=at/U,ue=-rt/U,de=Math.abs(ce*(E-w)+ue*(S-A));de<y?(C+=E,R+=S,M+=1):(v[v.length-1][v[v.length-1].length]=[z,it],w=z,A=it,C=z,R=it,M=1)}I==m[$].length-1&&(v[v.length-1][v[v.length-1].length]=[E,S])}}if(v.length>1&&e==!0){for(var Y=i*i+o*o,L=null,$=0;$<v.length;++$){var E=v[$][0][0],S=v[$][0][0],U=E*E+S*S;U<Y&&(Y=U,L=$)}if(L!=null){var T=[v[L]];v.splice(L,1)}for(;v.length>0;){var Y=i*i+o*o,w=T[T.length-1][T[T.length-1].length-1][0],A=T[T.length-1][T[T.length-1].length-1][1];L=null;for(var $=0;$<v.length;++$){var E=v[$][0][0],S=v[$][0][1],U=(E-w)*(E-w)+(S-A)*(S-A);U<Y&&(Y=U,L=$)}L!=null&&(T[T.length]=v[L],v.splice(L,1))}}else v.length>1&&e==!1||v.length==1?T=v:T=[];return console.log("rez",T),T}self.onmessage=function(n){const t=n.data;console.log("workerInternal.onmessage",t),buf=s(t.img,t.vectorFit,t.sort),self.postMessage([buf]),self.close()}}const Se={name:"img vectorize",inputs:[{name:"imageRGBA",type:"img_uint8"},{name:"vectorFit",type:"number",input:"box"},{name:"sort",type:"boolean",input:"check"}],outputs:[{name:"paths",type:"path"}],onUpdate(s,n){const t=s.outputs[0];return document.querySelector(`[data-id="${n}"] > .node-view`),`
      <div><span>paths</span> <span>${t.length}</span></div>
    `},func:async(s,n,t)=>{console.log("Vectorize Sort",t);const e=new Blob(["("+Ee.toString()+"())"]),o=window.URL.createObjectURL(e),i=new Worker(o);console.log("after new Worker");const l=new Promise(d=>{i.onmessage=u=>{console.log("receive worker.onmessage",u.data[0]),d(u.data[0])}});return console.log("work,postMessage"),n==0&&(n=1),i.postMessage({img:s,vectorFit:n,sort:t}),await Promise.all([l])}},Me={name:"img viewer",inputs:[{name:"imageRGBA",type:"img_uint8"}],outputs:[{name:"imageRGBA",type:"img_uint8"}],onUpdate(s){const n=s.inputs[0],t=document.createElement("canvas");t.width=n.width,t.height=n.height;const e=new ImageData(n.data,n.width);return t.getContext("2d").putImageData(e,0,0),t},func:s=>[s]},Le={name:"number",inputs:[{name:"inputNum",type:"number",input:"box"}],outputs:[{name:"outputNum",type:"number"}],onUpdate(s){return`value: ${s.inputs[0]}`},func(s){return[s]}},Be={name:"path viewer",inputs:[{name:"paths",type:"paths"}],outputs:[],onUpdate(s){const n=(i,l,d)=>{const u=(p,f,h)=>h===0?[...p,[[0,0],f[0],f[f.length-1]]]:[...p,[p[h-1][2],f[0],f[f.length-1]]];return i.reduce(u,[]).map(p=>p.slice(0,2)).map(p=>t(p,l,d,"red"))},t=(i,l,d,u="black")=>`<path d="${`M ${i.map(p=>`${p[0]} ${d-p[1]}`).join(",")}`}" fill="none" stroke="${u}"></path>`,e=(i,l,d)=>{const u=i.map(p=>t(p,l,d)),c=n(i,l,d);return[...u,...c]};return s.inputs[0]?`<svg viewBox="0 0 500 500">${e(s.inputs[0],100,100)}</svg>`:void 0},func:(s,n)=>[s+n]};function Re(){self.onmessage=function(s){const n=s.data;self.postMessage(n[0]+n[1]+100),self.close()}}const Ue={name:"web worker example",inputs:[{name:"x",type:"number",input:"box"},{name:"y",type:"number",input:"box"}],outputs:[{name:"sum",type:"number"}],onUpdate(s){},func:async(s,n)=>{const t=new Blob(["("+Re.toString()+"())"]),e=window.URL.createObjectURL(t),o=new Worker(e),i=new Promise(l=>{o.onmessage=d=>{const u=d.data;l(u)}});return o.postMessage([s,n]),await Promise.all([i])}},zt=s=>({get:n=>s.get(n),set:(n,t)=>(s.set(n,t),t)}),Nt=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,Ie=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Pe=/<[a-z][^>]+$/i,He=/>[^<>]*$/,De=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/gi,Oe=/\s+$/,Yt=(s,n)=>0<n--&&(Pe.test(s[n])||!He.test(s[n])&&Yt(s,n)),je=(s,n,t)=>Ie.test(n)?s:`<${n}${t.replace(Oe,"")}></${n}>`,qe=(s,n,t)=>{const e=[],{length:o}=s;for(let l=1;l<o;l++){const d=s[l-1];e.push(Nt.test(d)&&Yt(s,l)?d.replace(Nt,(u,c,p)=>`${n}${l-1}=${p||'"'}${c}${p?"":'"'}`):`${d}<!--${n}${l-1}-->`)}e.push(s[o-1]);const i=e.join("").trim();return t?i:i.replace(De,je)},{isArray:gt}=Array,{indexOf:We,slice:Xt}=[],Fe=({firstChild:s,lastChild:n})=>{const t=document.createRange();return t.setStartAfter(s),t.setEndAfter(n),t.deleteContents(),s},Ge=(s,n)=>s.nodeType===111?1/n<0?n?Fe(s):s.lastChild:n?s.valueOf():s.firstChild:s,ze=s=>{const{childNodes:n}=s,{length:t}=n;if(t<2)return t?n[0]:s;const e=Xt.call(n,0),o=e[0],i=e[t-1];return{ELEMENT_NODE:1,nodeType:111,firstChild:o,lastChild:i,valueOf(){if(n.length!==t){let l=0;for(;l<t;)s.appendChild(e[l++])}return s}}},Ye=(s,n,t,e,o)=>{const i=t.length;let l=n.length,d=i,u=0,c=0,p=null;for(;u<l||c<d;)if(l===u){const f=d<i?c?e(t[c-1],-0).nextSibling:e(t[d-c],0):o;for(;c<d;)s.insertBefore(e(t[c++],1),f)}else if(d===c)for(;u<l;)(!p||!p.has(n[u]))&&s.removeChild(e(n[u],-1)),u++;else if(n[u]===t[c])u++,c++;else if(n[l-1]===t[d-1])l--,d--;else if(n[u]===t[d-1]&&t[c]===n[l-1]){const f=e(n[--l],-1).nextSibling;s.insertBefore(e(t[c++],1),e(n[u++],-1).nextSibling),s.insertBefore(e(t[--d],1),f),n[l]=t[d]}else{if(!p){p=new Map;let f=c;for(;f<d;)p.set(t[f],f++)}if(p.has(n[u])){const f=p.get(n[u]);if(c<f&&f<d){let h=u,m=1;for(;++h<l&&h<d&&p.get(n[h])===f+m;)m++;if(m>f-c){const g=e(n[u],0);for(;c<f;)s.insertBefore(e(t[c++],1),g)}else s.replaceChild(e(t[c++],1),e(n[u++],-1))}else u++}else s.removeChild(e(n[u++],-1))}return t},Xe=s=>n=>{for(const t in n){const e=t==="role"?t:`aria-${t}`,o=n[t];o==null?s.removeAttribute(e):s.setAttribute(e,o)}},Ke=(s,n)=>{let t,e=!0;const o=document.createAttributeNS(null,n);return i=>{if(t!==i)if(t=i,t==null)e||(s.removeAttributeNode(o),e=!0);else{const l=i;l==null?(e||s.removeAttributeNode(o),e=!0):(o.value=l,e&&(s.setAttributeNodeNS(o),e=!1))}}},Ze=(s,n,t)=>e=>{t!==!!e&&((t=!!e)?s.setAttribute(n,""):s.removeAttribute(n))},Je=({dataset:s})=>n=>{for(const t in n){const e=n[t];e==null?delete s[t]:s[t]=e}},Tt=(s,n)=>{let t,e,o=n.slice(2);return!(n in s)&&(e=n.toLowerCase())in s&&(o=e.slice(2)),i=>{const l=gt(i)?i:[i,!1];t!==l[0]&&(t&&s.removeEventListener(o,t,l[1]),(t=l[0])&&s.addEventListener(o,t,l[1]))}},Qe=s=>{let n;return t=>{n!==t&&(n=t,typeof t=="function"?t(s):t.current=s)}},Ve=(s,n)=>n==="dataset"?Je(s):t=>{s[n]=t},tn=s=>{let n;return t=>{n!=t&&(n=t,s.textContent=t==null?"":t)}},en=({childNodes:s},n)=>s[n],K=(s,n,t)=>Ye(s.parentNode,n,t,Ge,s),nn=s=>{let n,t,e=[];const o=i=>{switch(typeof i){case"string":case"number":case"boolean":n!==i&&(n=i,t||(t=document.createTextNode("")),t.data=i,e=K(s,e,[t]));break;case"object":case"undefined":if(i==null){n!=i&&(n=i,e=K(s,e,[]));break}if(gt(i)){n=i,i.length===0?e=K(s,e,[]):typeof i[0]=="object"?e=K(s,e,i):o(String(i));break}n!==i&&"ELEMENT_NODE"in i&&(n=i,e=K(s,e,i.nodeType===11?Xt.call(i.childNodes):[i]));break;case"function":o(i(s));break}};return o},on=(s,n)=>{switch(n[0]){case"?":return Ze(s,n.slice(1),!1);case".":return Ve(s,n.slice(1));case"@":return Tt(s,"on"+n.slice(1));case"o":if(n[1]==="n")return Tt(s,n)}switch(n){case"ref":return Qe(s);case"aria":return Xe(s)}return Ke(s,n)};function sn(s){const{type:n,path:t}=s,e=t.reduceRight(en,this);return n==="node"?nn(e):n==="attr"?on(e,s.name):tn(e)}var kt=function(s){var n="fragment",t="template",e="content"in l(t),o=e?function(u){var c=l(t);return c.innerHTML=u,c.content}:function(u){var c=l(n),p=l(t),f=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(u)){var h=RegExp.$1;p.innerHTML="<table>"+u+"</table>",f=p.querySelectorAll(h)}else p.innerHTML=u,f=p.childNodes;return i(c,f),c};return function(c,p){return(p==="svg"?d:o)(c)};function i(u,c){for(var p=c.length;p--;)u.appendChild(c[0])}function l(u){return u===n?s.createDocumentFragment():s.createElementNS("http://www.w3.org/1999/xhtml",u)}function d(u){var c=l(n),p=l("div");return p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+u+"</svg>",i(c,p.firstChild.childNodes),c}}(document);const Kt=document.importNode.length!=1,rn=Kt?(s,n,t)=>document.importNode(kt(s,n,t),!0):kt,an=Kt?s=>document.createTreeWalker(s,129,null,!1):s=>document.createTreeWalker(s,129),ct=s=>{const n=[];let{parentNode:t}=s;for(;t;)n.push(We.call(t.childNodes,s)),s=t,t=s.parentNode;return n},Z="is\xB5",Ct=zt(new WeakMap),ln=/^(?:plaintext|script|style|textarea|title|xmp)$/i,st=()=>({stack:[],entry:null,wire:null}),cn=(s,n)=>{const{content:t,updates:e}=dn(s,n);return{type:s,template:n,content:t,updates:e,wire:null}},un=(s,n)=>{const t=qe(n,Z,s==="svg"),e=rn(t,s),o=an(e),i=[],l=n.length-1;let d=0,u=`${Z}${d}`;for(;d<l;){const c=o.nextNode();if(!c)throw`bad template: ${t}`;if(c.nodeType===8)c.data===u&&(i.push({type:"node",path:ct(c)}),u=`${Z}${++d}`);else{for(;c.hasAttribute(u);)i.push({type:"attr",path:ct(c),name:c.getAttribute(u)}),c.removeAttribute(u),u=`${Z}${++d}`;ln.test(c.tagName)&&c.textContent.trim()===`<!--${u}-->`&&(c.textContent="",i.push({type:"text",path:ct(c)}),u=`${Z}${++d}`)}}return{content:e,nodes:i}},dn=(s,n)=>{const{content:t,nodes:e}=Ct.get(n)||Ct.set(n,un(s,n)),o=document.importNode(t,!0),i=e.map(sn,o);return{content:o,updates:i}},ft=(s,{type:n,template:t,values:e})=>{const{length:o}=e;Zt(s,e,o);let{entry:i}=s;(!i||i.template!==t||i.type!==n)&&(s.entry=i=cn(n,t));const{content:l,updates:d,wire:u}=i;for(let c=0;c<o;c++)d[c](e[c]);return u||(i.wire=ze(l))},Zt=({stack:s},n,t)=>{for(let e=0;e<t;e++){const o=n[e];o instanceof Jt?n[e]=ft(s[e]||(s[e]=st()),o):gt(o)?Zt(s[e]||(s[e]=st()),o,o.length):s[e]=null}t<s.length&&s.splice(t)};function Jt(s,n,t){this.type=s,this.template=n,this.values=t}const{create:fn,defineProperties:hn}=Object,Qt=s=>{const n=zt(new WeakMap),t=e=>(o,...i)=>ft(e,{type:s,template:o,values:i});return hn((e,...o)=>new Jt(s,e,o),{for:{value(e,o){const i=n.get(e)||n.set(e,fn(null));return i[o]||(i[o]=t(st()))}},node:{value:(e,...o)=>ft(st(),{type:s,template:e,values:o}).valueOf()}})},Vt=Qt("html");Qt("svg");const pn={name:"web serial",inputs:[],outputs:[],onUpdate(s){return Vt.node`
      <button @click=${mn}>ports</button>
    `},func:(s,n)=>[s+n]};async function mn(){const s=await navigator.serial.getPorts();console.log("ports",s)}const gn={name:"web socket",inputs:[{name:"msg",type:"string",input:"box"}],outputs:[],onUpdate(s){return Vt.node`
      <button @click=${()=>vn(s.state)}>start socket</button>
    `},func:s=>(console.log(s),[])};function vn(s){var n=new WebSocket("ws://localhost:3000");n.onopen=()=>{n.send("r"),s.count++},n.onclose=function(){console.log("web socket closed")}}const F={adder:ge,async_adder:ve,img_distance:$e,img_edge_detect:Ae,img_offset:_e,img_read_png:xe,img_sample:Te,img_threshold:Ce,img_vectorize:Se,img_viewer:Me,number:Le,path_viewer:Be,worker_example:Ue,webSerial:pn,webSocket:gn},x={nodeTypes:F,nodes:{fds:{type:"number",x:150,y:0,inputs:[0],outputs:[42],evaluated:[!1]},fsa:{type:"number",x:30,y:0,inputs:[0],outputs:[43],evaluated:[!1]},dsf:{type:"adder",x:100,y:100,inputs:[0,0],outputs:[42],evaluated:[!1]}},connections:[["fsa:out:0","dsf:in:0"],["fsa:out:0","fds:in:0"],["fds:out:0","dsf:in:1"]],selectedNodes:[],tempEdge:["",[0,0]],dataflow:null,name:"default-name"};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const yn={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},$n=s=>(...n)=>({_$litDirective$:s,values:n});class wn{constructor(n){}get _$AU(){return this._$AM._$AU}_$AT(n,t,e){this._$Ct=n,this._$AM=t,this._$Ci=e}_$AS(n,t){return this.update(n,t)}update(n,t){return this.render(...t)}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{I:An}=pe,Et=()=>document.createComment(""),J=(s,n,t)=>{var e;const o=s._$AA.parentNode,i=n===void 0?s._$AB:n._$AA;if(t===void 0){const l=o.insertBefore(Et(),i),d=o.insertBefore(Et(),i);t=new An(l,d,s,s.options)}else{const l=t._$AB.nextSibling,d=t._$AM,u=d!==s;if(u){let c;(e=t._$AQ)===null||e===void 0||e.call(t,s),t._$AM=s,t._$AP!==void 0&&(c=s._$AU)!==d._$AU&&t._$AP(c)}if(l!==i||u){let c=t._$AA;for(;c!==l;){const p=c.nextSibling;o.insertBefore(c,i),c=p}}}return t},H=(s,n,t=s)=>(s._$AI(n,t),s),bn={},_n=(s,n=bn)=>s._$AH=n,xn=s=>s._$AH,ut=s=>{var n;(n=s._$AP)===null||n===void 0||n.call(s,!1,!0);let t=s._$AA;const e=s._$AB.nextSibling;for(;t!==e;){const o=t.nextSibling;t.remove(),t=o}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const St=(s,n,t)=>{const e=new Map;for(let o=n;o<=t;o++)e.set(s[o],o);return e},Nn=$n(class extends wn{constructor(s){if(super(s),s.type!==yn.CHILD)throw Error("repeat() can only be used in text expressions")}ht(s,n,t){let e;t===void 0?t=n:n!==void 0&&(e=n);const o=[],i=[];let l=0;for(const d of s)o[l]=e?e(d,l):l,i[l]=t(d,l),l++;return{values:i,keys:o}}render(s,n,t){return this.ht(s,n,t).values}update(s,[n,t,e]){var o;const i=xn(s),{values:l,keys:d}=this.ht(n,t,e);if(!Array.isArray(i))return this.ut=d,l;const u=(o=this.ut)!==null&&o!==void 0?o:this.ut=[],c=[];let p,f,h=0,m=i.length-1,g=0,r=l.length-1;for(;h<=m&&g<=r;)if(i[h]===null)h++;else if(i[m]===null)m--;else if(u[h]===d[g])c[g]=H(i[h],l[g]),h++,g++;else if(u[m]===d[r])c[r]=H(i[m],l[r]),m--,r--;else if(u[h]===d[r])c[r]=H(i[h],l[r]),J(s,c[r+1],i[h]),h++,r--;else if(u[m]===d[g])c[g]=H(i[m],l[g]),J(s,i[h],i[m]),m--,g++;else if(p===void 0&&(p=St(d,g,r),f=St(u,h,m)),p.has(u[h]))if(p.has(u[m])){const a=f.get(d[g]),y=a!==void 0?i[a]:null;if(y===null){const v=J(s,i[h]);H(v,l[g]),c[g]=v}else c[g]=H(y,l[g]),J(s,i[h],y),i[a]=null;g++}else ut(i[m]),m--;else ut(i[h]),h++;for(;g<=r;){const a=J(s,c[r+1]);H(a,l[g]),c[g++]=a}for(;h<=m;){const a=i[h++];a!==null&&ut(a)}return this.ut=d,_n(s,c),W}});function Tn(s,n,t,e,o,i){const l=s.target.files;d(l);function d(p,f=[]){let h=p[0],m=h.name.split(".");if(m[0],m[m.length-1],f.length>0&&f.includes(enxtension))throw"Extension not recongized: "+m;u(h)}function u(p){if(F[n.type].inputs[i].type==="img_uint8"){const m=new FileReader;m.readAsDataURL(p),m.onloadend=c}}function c(p){var f=new Image;f.setAttribute("src",p.target.result),f.onload=function(){const h=document.createElement("canvas");if(h.height=f.height,h.width=f.width,f.width>f.height)var m=0,g=h.height*.5*(1-f.height/f.width),r=h.width,a=h.width*f.height/f.width;else var m=h.width*.5*(1-f.width/f.height),g=0,r=h.height*f.width/f.height,a=h.height;var y=h.getContext("2d");y.clearRect(0,0,h.width,h.height),y.drawImage(f,m,g,r,a);var y=h.getContext("2d");y.canvas.width=f.width,y.canvas.height=f.height,y.drawImage(f,0,0);const v=y.getImageData(0,0,y.canvas.width,y.canvas.height);n.inputs[i]={data:v.data,width:v.width,height:v.height}}}}function kn(s){x.connections=x.connections.filter(([n,t])=>!n.includes(s)&&!t.includes(s)),delete x.nodes[s],x.selectedNodes=x.selectedNodes.filter(n=>n!==s)}async function Cn(s,n,t,e){function o(){const f=Object.keys(n),h={};return f.forEach(m=>h[m]=-1),l(h)(s,0),h}function i(f,h,m){return m.indexOf(f)===h}const l=f=>(h,m)=>{f[h]=m++,t.filter(([r,a])=>a.includes(h)).map(r=>r[0].split(":")[0]).filter(i).forEach(r=>l(f)(r,m))},d=f=>{let h=[];for(const m in f){const g=f[m];if(!(g<0)){for(;h.length<=g;)h.push([]);h[g].push(m)}}return h=h.reverse(),h},u=async f=>{const h=n[f],m=h.type,g=e[m],r=g.func,a=h.inputs.map((w,A)=>`${f}:in:${A}`),y={};t.forEach(w=>{y[w[1]]=w[0]}),a.forEach(w=>{if(w in y){const A=w.split(":")[2],C=y[w],[R,M,I]=C.split(":"),z=n[R].outputs[I];h.inputs[A]=z}});const v=g.inputs.map(w=>w.type);h.inputs.forEach((w,A)=>{v[A]==="number"&&(h.inputs[A]=Number(w))});const $=await r(...h.inputs);return h.outputs=$,$},c=o(),p=d(c);for(let f of p){const h=f.map(u);await Promise.all(h),f.forEach(m=>{const g=n[m],r=g.type,a=e[r];if(a.func,!a.onUpdate)return;const y=a.onUpdate(g),v=document.querySelector(`[data-id="${m}"] > .node-view`);if(typeof y=="string")v.innerHTML=y;else{for(;v.firstChild;)v.removeChild(v.lastChild);v.append(y)}})}}function te(s){Cn(s,x.nodes,x.connections,x.nodeTypes).then(()=>{})}const ht={number:0,string:"",img_uint8:En(),img_float32:{data:new Float32Array(1),width:1,height:1},boolean:!0,path:[]};function En(){const t=new Uint8ClampedArray(4e4);for(let e=0;e<100;e++)for(let o=0;o<100;o++)t[(e*100+o)*4]=e*255/100,t[(e*100+o)*4+1]=o*255/100,t[(e*100+o)*4+2]=0,t[(e*100+o)*4+3]=255;return{data:t,width:100,height:100}}function Mt(s,n){const t={img_uint8:e=>({data:btoa(e.data.reduce((o,i)=>o+String.fromCharCode(i),"")),width:e.width,height:e.height})};return s in t?t[s](n):n}function Lt(s,n){const t={img_uint8:e=>({data:Sn(e.data),width:e.width,height:e.height})};return s in t?t[s](n):n}const Sn=s=>{const n=atob(s),t=n.length,e=new Uint8ClampedArray(t);for(let o=0;o<t;o++){const l=n[o].charCodeAt(0);e[o]=l}return e};function Mn({nodes:s,connections:n,name:t}){const e={nodes:{},connections:n,name:t};for(const o in s){const i={},l=s[o];i.x=l.x,i.y=l.y,i.type=l.type,i.inputs=[],i.outputs=[],i.evaluated=[];const d=l.type,u=F[d].inputs.map(p=>p.type),c=F[d].outputs.map(p=>p.type);u.forEach((p,f)=>{const h=l.inputs[f];i.inputs[f]=Mt(p,h)}),c.forEach((p,f)=>{const h=ht[p];i.outputs[f]=Mt(p,h),i.evaluated[f]=!1}),e.nodes[o]=i}return JSON.stringify(e)}function Ln(s){const n=JSON.parse(s),t=n.nodes;for(const e in t){const o={},i=t[e];o.x=i.x,o.y=i.y,o.type=i.type,o.inputs=[],o.outputs=[],o.evaluated=[];const l=i.type,d=F[l].inputs.map(c=>c.type),u=F[l].outputs.map(c=>c.type);d.forEach((c,p)=>{const f=i.inputs[p];o.inputs[p]=Lt(c,f)}),u.forEach((c,p)=>{const f=i.outputs[p];o.outputs[p]=Lt(c,f),o.evaluated[p]=!1}),t[e]=o}return n}function Bn(s,n){const t=new Blob([n],{type:"text/plain"}),e=document.createElement("a");e.href=URL.createObjectURL(t),e.download=`${s}`,e.click(),URL.revokeObjectURL(e)}function Rn(){const{nodes:s,connections:n,name:t}=x,e=Mn({nodes:s,connections:n,name:t});Bn(`${x.name}.json`,e)}function Un(s){return s=s.replaceAll(" ","-"),s===""&&(s="defaultName"),s}function In(s){x.name=Un(s)}function ee(s){const{nodes:n,connections:t,name:e}=Ln(s);x.nodes=n,x.connections=t,x.name=e}const Pn=s=>k`
  <div class="toolbox-node" data-type=${s}>
    ${s}
  </div>
`,Hn=(s,n,t)=>k`
  <div class="node-input">
    <div
      class=${["node-input-circle","socket",["upload"].includes(t.input)?"hide-socket":""].join(" ")}
      data-id=${`${s}:in:${n}`}></div>
    <div class="node-input-name">${t.name}</div>
  </div>
`,Dn=(s,n,t)=>k`
  <div class="node-output">
    <div class="node-output-name">${t.name}</div>
    <div
      class="node-output-circle socket"
      data-id=${`${s}:out:${n}`}></div>
  </div>
`,On=(s,n)=>{const[t,e]=s,o=n.nodeTypes[e.type];if(!o)throw["The node type '",e.type,"' isn't a known one (name change?): ",Object.keys(n.nodeTypes)].join("");const i=n.selectedNodes.includes(t);return k`
    <div
      class=${["node",i?"selected-node":""].join(" ")}
      data-id=${t}
      style=${`left: ${e.x}px; top: ${e.y}px;`}>
      <div class="node-title">
        <div class="node-name">${o.name}</div>
        <div class="node-buttons">
          <div class="node-play" @click=${l=>te(t)}>►</div>
          <div class="node-delete" @click=${l=>kn(t)}>x</div>
        </div>
      </div>
      ${o.inputs.map((l,d)=>Hn(t,d,l))}
      ${o.outputs.map((l,d)=>Dn(t,d,l))}
      <div class="node-view"></div>
    </div>
  `};function jn(s,n){const{nodes:t}=n,[e,o]=s.map(v=>v.split(":")[0]),[i,l]=s.map(v=>Number(v.split(":")[2])),{x:d,y:u,inputs:c}=t[e],{x:p,y:f}=t[o];if(n.dataflow===null)return;const h=(d+190)*n.dataflow.scale()+n.dataflow.x(),m=(u+37+18.5*(i+c.length))*n.dataflow.scale()+n.dataflow.y(),g=p*n.dataflow.scale()+n.dataflow.x(),r=(f+37+18.5*l)*n.dataflow.scale()+n.dataflow.y();let a=Math.abs(h-g);a=a/1.3;const y=`M ${h} ${m} C ${h+a} ${m}, ${g-a} ${r}, ${g} ${r}`;return dt`
    <path class="edge" stroke-width=${`${3*n.dataflow.scale()}px`} vector-effect="non-scaling-stroke" d=${y}/>
  `}function qn(s,n){if(!document.querySelector(".socket"))return;const[t,[e,o]]=s;if(t===""||n.dataflow===null)return dt``;const{x:i,y:l,inputs:d}=n.nodes[t.split(":")[0]],u=Number(t.split(":")[2]),c=(i+190)*n.dataflow.scale()+n.dataflow.x(),p=(l+37+18.5*(u+d.length))*n.dataflow.scale()+n.dataflow.y();let f=Math.abs(c-e);f=f/1.3;const h=`M ${c} ${p} C ${c+f} ${p}, ${e-f} ${o}, ${e} ${o}`;return dt`
    <path class="edge" stroke-width=${`${3*n.dataflow.scale()}px`} vector-effect="non-scaling-stroke" d=${h}>
  `}const Wn=s=>!s||!s.start||!s.end?"":k`
    <div
      class="select-box"
      style=${`
        background: blue;
        opacity: 0.1;
        z-index: 100;
        position: absolute;
        left: ${s.start[0]}px;
        top:${s.start[1]}px;
        width: ${Math.abs(s.end[0]-s.start[0])}px;
        height:${Math.abs(s.end[1]-s.start[1])}px;
      `}>
    </div>
  `;function Fn(s){const n=s.selectedNodes[0],t=s.nodes[n],e=s.nodeTypes[t.type],o=(d,u)=>{t.inputs[u]=d},i={box:(d,u,c,p)=>k`
      <div class="node-editor-input">
        <span>${d}:</span>
        <input
          .value=${u}
          .disabled=${c}
          @blur=${pt}
          @input=${f=>o(f.target.value,p)}/>
      </div>
    `,check:(d,u,c,p)=>k`
      <div class="node-editor-input">
        <span>${d}:</span>
        <input
          type=checkbox
          .checked=${u?"checked":""}
          .disabled=${c}
          @blur=${pt}
          @input=${f=>o(!!f.target.checked,p)}/>
      </div>
    `,upload:(d,u,c,p)=>k`
      <div class="node-editor-input">
        <input type="file" @change=${f=>Tn(f,t,d,u,c,p)}/>
      </div>
    `},l=(d,u)=>{const c=s.connections.some(([f,h])=>h===`${n}:in:${u}`);return d.input&&d.input in i?i[d.input](d.name,t.inputs[u],c,u):k``};return k`
    <div class="node-editor-name">${t.type}</div>
    ${e.inputs.map(l)}
  `}function Gn(s){var e;let n=((e=document.querySelector(".toolbox-search"))==null?void 0:e.value)||"";n=n.toLowerCase();const t=Object.keys(s.nodeTypes).filter(o=>o.toLowerCase().includes(n));return k`
    <div class="root">
      <div class="menu">
        <div 
          class="menu-item menu-name" 
          contenteditable 
          spellcheck="false"
          @blur=${o=>In(o.target.innerText)}>${s.name}</div>
        <div class="menu-item" @click=${()=>Rn()}>save</div>
        <div class="menu-item" @click=${()=>document.getElementById("load_file").click()}>load</div>
        <!-- hidden -->
        <input type="file" accept=".json" style="display:none;" id="load_file" name="file" @input=${o=>{const i=o.target.files[0];zn(i).then(l=>ee(l))}}>

        <div class="menu-item dropdown-container">
          list menu
          <div class="dropdown-list">
            <span>
              option 1
            </span>
            <span>
              option 2
            </span>
          </div>
        </div>
        <a class="menu-item" href="https://github.com/leomcelroy/yada" target="_blank">github</a>
      </div>
      <div class="bottom-container">
        <div class="toolbox">
          <div class="toolbox-search-container">
            <input class="toolbox-search" @input=${pt}></input>
            <div class="toolbox-search-results">
              ${t.map(Pn)}
            </div>
          </div>
          ${s.selectedNodes.length===1?k`<div class="node-input-editor">
                  ${Fn(s)}
                  <div>state: ${JSON.stringify(s.nodes[s.selectedNodes[0]].state)}</div>
                </div>`:""}
        </div>
        <div class="dataflow">
          <svg class="edges">
            <g>
              ${s.connections.map(o=>jn(o,s))}
              ${qn(s.tempEdge,s)}
            </g>
          </svg>
          <div class="nodes">
            <div class="transform-group">
              ${Nn(Object.entries(s.nodes),o=>o[0],o=>On(o,s))}
              
              ${Wn(s.selectBox)}
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function zn(s){return new Promise((n,t)=>{let e=new FileReader;e.onload=o=>n(e.result),e.readAsText(s)})}const pt=()=>{},Bt=(s,n)=>{let t=document.querySelector(n).getBoundingClientRect(),e=s.clientX-t.left,o=s.clientY-t.top;return[e,o]};function Yn(s,n){let t=null,e=null;const o=n.dataflow;n.selectBox={start:[0,0],end:[0,0]},s("mousedown",".nodes",l=>{if(!l.shiftKey)return;const[d,u]=Bt(l,".dataflow");t=o.getPoint(d,u)}),s("mousemove","",l=>{if(document.body.classList.add("no-select"),!l.shiftKey||t===null)return;const[d,u]=Bt(l,".dataflow");e=o.getPoint(d,u),n.selectBox.start=[Math.min(t[0],e[0]),Math.min(t[1],e[1])],n.selectBox.end=[Math.max(t[0],e[0]),Math.max(t[1],e[1])]});function i(l,d){let{start:u,end:c}=d;return l.x>u.x&&l.x<c.x&&l.y>u.y&&l.y<c.y||l.x>u.x&&l.x<c.x&&l.y<u.y&&l.y>c.y||l.x<u.x&&l.x>c.x&&l.y>u.y&&l.y<c.y||l.x<u.x&&l.x>c.x&&l.y<u.y&&l.y>c.y}s("mouseup","",l=>{!l.shiftKey||(document.body.classList.remove("no-select"),t&&e&&Object.entries(n.nodes).forEach(([d,u])=>{i(u,{start:{x:t[0],y:t[1]},end:{x:e[0],y:e[1]}})&&!n.selectedNodes.includes(d)&&n.selectedNodes.push(d)}),t=null,e=null,n.selectBox.start=t,n.selectBox.end=e)})}function Xn(s,n=[]){let t=s[0],e=t.name.split(".");if(e[0],e[e.length-1],n.length>0&&n.includes(enxtension))throw"Extension not recongized: "+e;Kn(t)}function Kn(s){var n=new FileReader;n.readAsText(s),n.onloadend=t=>{const e=n.result;try{ee(e)}catch{}}}function Zn(s,n){s("drop","",function(t){let o=t.dataTransfer.files;Xn(o),Rt(t)}),s("dragover","",function(t){Rt(t)})}function Rt(s){return s.stopPropagation&&s.stopPropagation(),s.preventDefault&&s.preventDefault(),s.cancelBubble=!0,s.returnValue=!1,!1}const ne=s=>s.composedPath()[0],Jn=(s,n)=>ne(s).matches(n),Qn=s=>(n,t,e)=>{s.addEventListener(n,o=>{o.trigger=ne(o),(t===""||Jn(o,t))&&e(o)})};function Vn(s){let n=!1;const t=r=>{n=r},e=Qn(s),o=s.querySelectorAll(".transform-group"),i=r=>{let a=s.getBoundingClientRect(),y=r.clientX-a.left,v=r.clientY-a.top;return[y,v]};let l=!1,d=1,u=0,c=0,p={x:0,y:0};function f(r){r.forEach(a=>{a.style.transformOrigin=`${0}px ${0}px`,a.style.transform="translate("+u+"px, "+c+"px) scale("+d+")"})}function h(r,a){let y=(r-u)/d,v=(a-c)/d;return[y,v]}e("mousedown","",r=>{if(n||r.shiftKey)return;const[a,y]=i(r);l=!0,p={x:a-u,y:y-c},r.detail===2&&console.log(a,y,h(a,y))}),e("mousemove","",r=>{if(n||!l)return;const[a,y]=i(r);u=a-p.x,c=y-p.y,f(o)}),e("mouseup","",r=>{l=!1}),e("mouseout","",r=>{l=!1}),e("wheel","",r=>{const[a,y]=i(r);let v=(a-u)/d,$=(y-c)/d;Math.sign(r.deltaY)<0?d*=1.03:d/=1.03,u=a-v*d,c=y-$*d,f(o),r.preventDefault()});function m(r){const a=s.getBoundingClientRect(),y=r.x[1]-r.x[0],v=r.y[1]-r.y[0],$=a.width/y,w=a.height/v,A=Math.min($,w)*.9;d=A;const C={x:(r.x[0]+r.x[1])/2*A-a.width/2,y:(r.y[0]+r.y[1])/2*A-a.height/2};u=-C.x,c=-C.y,f(o)}function g(){if(s===null)return null;const{left:r,right:a,bottom:y,top:v,width:$,height:w}=s.getBoundingClientRect(),A=h($,w),C=h(0,w),R=h($,0),M=h(0,0);return{rt:A,lt:C,rb:R,lb:M}}return{scale:()=>d,x:()=>u,y:()=>c,corners:g,getPoint:h,setScaleXY:m,togglePanZoom:t}}function Ut(s){x.connections=x.connections.filter((n,t)=>t!==s)}function to(s,n){x.connections.push([s,n])}function eo(s,n,t){const e=x.nodes[s];!e||(e.x+=n,e.y+=t)}const oe=s=>s.composedPath()[0],no=(s,n)=>oe(s).matches(n),Q=(s,n)=>s.composedPath().some(t=>t.matches&&t.matches(n)),oo=s=>(n,t,e)=>{s.addEventListener(n,o=>{o.trigger=oe(o),(t===""||no(o,t))&&e(o)})};function so(s,n){const t=document.querySelector(s),e=document.querySelector(n),o=t.getBoundingClientRect(),i=e.getBoundingClientRect(),l=o.top-i.top;return[o.left-i.left,l]}const se=(s,n)=>{let t=document.querySelector(n).getBoundingClientRect(),e=s.clientX-t.left,o=s.clientY-t.top;return[e,o]};function io(s,n){let t=!1,e="",o="";s("mousedown",".toolbox-node",i=>{o=i.target.dataset.type,t=!0,e=Math.random().toString(16).slice(2)}),s("mousemove","",i=>{if(!t)return;const[l,d]=n.dataflow.getPoint(...se(i,".dataflow")),{inputs:u,outputs:c}=n.nodeTypes[o],p=u.map(h=>ht[h.type]),f=c.map(h=>ht[h.type]);n.nodes[e]={type:o,state:{},x:l,y:d,inputs:p,outputs:f,evaluated:new Array(f.length).fill(!1)}}),s("mouseup","",i=>{t&&Q(i,".toolbox")&&delete n.nodes[e],e!==""&&Q(i,".dataflow")&&te(e),e="",t=!1})}function ro(s,n){let t="",e="",o=-1;s("mousedown",".node-input-circle",i=>{const l=i.target.dataset.id,d=n.connections.find(u=>u[1]===l);o=n.connections.findIndex(u=>u[1]===l),d&&(t=d[0])}),s("mousedown",".node-output-circle",i=>{t=i.target.dataset.id}),s("mouseup",".node-input-circle",i=>{e=i.target.dataset.id}),s("wheel","",i=>{}),s("mousemove","",i=>{t!==""&&(document.querySelector(`[data-id="${t}"]`).getBoundingClientRect(),so(`[data-id="${t}"]`,".dataflow"),n.tempEdge=[t,se(i,".dataflow")]),o!==-1&&(Ut(o),o=-1)}),s("mouseup","",i=>{t!==""&&(t!==""&&e!==""&&(o=n.connections.findIndex(l=>l[1]===e),o!==-1&&Ut(o),to(t,e)),t="",e="",o=-1,n.tempEdge=["",[0,0]])})}function ao(s,n){let t=!1,e="";s("mousedown","",o=>{if(document.body.classList.add("no-select"),Q(o,".socket")){n.dataflow.togglePanZoom(!0);return}!Q(o,".dataflow")||(t=o.composedPath().find(i=>i.matches&&i.matches(".node")),Q(o,".node")?(n.dataflow.togglePanZoom(!0),e=t.dataset.id,n.selectedNodes.includes(e)&&o.detail===2||(!n.selectedNodes.includes(e)&&!o.shiftKey?n.selectedNodes=[e]:!n.selectedNodes.includes(e)&&o.shiftKey&&n.selectedNodes.push(e))):o.shiftKey||(n.selectedNodes=[]))}),s("mousemove","",o=>{if(!t)return;const i=n.dataflow.scale();n.selectedNodes.forEach(l=>{eo(l,o.movementX/i,o.movementY/i)})}),s("mouseup","",o=>{document.body.classList.remove("no-select"),t=!1,e="",n.dataflow.togglePanZoom(!1)})}function lo(s){s.dataflow=Vn(document.querySelector(".dataflow"));const n=document.querySelector("body"),t=oo(n);ao(t,s),ro(t,s),io(t,s),Yn(t,s),Zn(t)}const ie=()=>me(Gn(x),document.body);window.LOG_STATE=()=>console.log(x);const re=s=>{ie(),requestAnimationFrame(re)};window.addEventListener("load",()=>{ie(),lo(x),requestAnimationFrame(re)});
